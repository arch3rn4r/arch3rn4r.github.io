<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="arch3rn4r">
    
    <title>
        
            Frida-Labs wp |
        
        arch3rn4r
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/solid.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/brands.min.css">
    
        
            
        
            
                
<link rel="stylesheet" href="/css/custom.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"arch3rn4r.github.io","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"arch3rn4r","author":"arch3rn4r","avatar":"/images/beauty/myhead.svg"},"menu":{"home":"/                        || fa-solid fa-home","archives":"/archives            || fa-solid fa-box-archive","tags":"/tags                    || fa-solid fa-tags","about":"/about                || fa-solid fa-user-graduate"},"first_screen":{"enable":true,"background_img":"/images/beauty/bg.jpg","background_img_dark":"https://arch3rn4r.github.io/picx-images-hosting/20240915/EYnModKVcAAy6sw.4g4g8oqoi0.webp","description":"这里是雨季，你那里阳光明媚吗","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":null,"category":false,"tag":true,"post_datetime":"updated"},"post":{"author_badge":{"enable":false,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":"ture"},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":true,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default","code_block_shrink":false},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"left"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":true,"use":"giscus","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":"arch3rn4r/arch3rn4r.github.io","repo_id":"R_kgDOLnMFhw","category":"Announcements","category_id":"DIC_kwDOLnMFh84Cik-D","reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":true},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":true,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":true,"css":[null,"/css/custom.css"],"js":[null]},"root":"","source_data":{},"version":"4.2.3"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="arch3rn4r" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
            <a class="site-name border-box" href="/">
               arch3rn4r
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                标签
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-user-graduate"></i>
                                
                                关于
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            标签
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-user-graduate"></i>
                                </span>
                            
                            关于
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        Frida-Labs wp
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/beauty/myhead.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">arch3rn4r</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2025-04-17 11:37:27</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Fri May 02 2025 10:41:58 GMT+0800">2025-05-02 10:41:58</span>
            </span>
        

        

        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>9.5k 字</span>
            </span>
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="0x1-同一个类中的静态方法"><a href="#0x1-同一个类中的静态方法" class="headerlink" title="0x1 同一个类中的静态方法"></a>0x1 同一个类中的静态方法</h2><p>分析<br>基本结构如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (TextUtils.isDigitsOnly(obj)) &#123;</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.check(i, Integer.parseInt(obj));</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> i2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((i * <span class="number">2</span>) + <span class="number">4</span> == i2) &#123;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>满足check的逻辑就可以，<code>i2=i*2+4</code><br>这里的check方法会主动触发，不需要额外调用，在这里，只需要更改原来check的逻辑就可以了</p>
<p>方法一<br>以下代码的编写是在jadx里直接“复制为frida片段”获得</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hookTest1 is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="title class_">MainActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);</span><br><span class="line">        <span class="title class_">MainActivity</span>[<span class="string">&quot;check&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">i, i2</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`MainActivity.check is called: i=<span class="subst">$&#123;i&#125;</span>, i2=<span class="subst">$&#123;i2&#125;</span>`</span>);</span><br><span class="line">            i2=i*<span class="number">2</span>+<span class="number">4</span>;  <span class="comment">//在这里定义i2</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`i2 is changed to <span class="subst">$&#123;i2&#125;</span>`</span>);</span><br><span class="line">            <span class="variable language_">this</span>[<span class="string">&quot;check&quot;</span>](i, i2);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>方法二<br>以下代码调用Frida 的 JavaScript API。<br><strong>onMatch: function (instance) { … }</strong><br>该回调函数会在每次找到 className 指定的类的实例时被调用。<br><strong>nComplete: function () { … }</strong></p>
<ul>
<li>这个回调函数在 Frida 完成了对所有目标进程的内存扫描，并且枚举完所有 className 指定的类的实例之后被调用。</li>
<li>可以在 onComplete 函数中执行一些清理工作，或者打印一些总结信息。onComplete: function () {}，这意味着在枚举完成之后什么也不做。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">instance</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] 找到 MainActivity 实例，自动触发解密&quot;</span>);</span><br><span class="line">        instance.<span class="title function_">check</span>(<span class="number">0</span>, <span class="number">4</span>); <span class="comment">// 传入 i=0, i2=4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>方法三<br><strong>a.check.overload(‘int’, ‘int’).implementation &#x3D; function(a, b) { … }</strong></p>
<ul>
<li><strong>.overload(‘int’, ‘int’)</strong>: 指定要 hook 的 check 方法的重载版本。 check 方法可能存在多个重载版本，’int’, ‘int’ 表示选择接受两个 int 类型参数的版本。 这很重要，因为如果方法有多个重载，你必须明确指定要 hook 的版本。</li>
<li><strong>.implementation &#x3D; function(a, b) { … }</strong>: 设置 hook 的具体实现。 你在这里定义的函数将会在每次调用被 hook 的 check 方法时被执行。</li>
<li>this.originalMethod() 用于调用原始的方法（如果需要）<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);</span><br><span class="line">  a.<span class="property">check</span>.<span class="title function_">overload</span>(<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">check</span>(<span class="number">4</span>, <span class="number">12</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="0x2-主动调用同一个类中的静态方法"><a href="#0x2-主动调用同一个类中的静态方法" class="headerlink" title="0x2 主动调用同一个类中的静态方法"></a>0x2 主动调用同一个类中的静态方法</h2><p>主要逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(C0497R.layout.activity_main);</span><br><span class="line">        f103t1 = (TextView) findViewById(C0497R.id.textview);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">get_flag</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="number">4919</span>) &#123;</span><br><span class="line">           </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次目标方法不再原本的程序流程内，需要额外进行调用<br>java.choose和在jadx直接赋值frida片段都是调用的实例化对象，而get_flag没有被实例化</p>
<p>Java.choose 只能找到已经实例化的对象,所以这个代码不行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>,&#123;</span><br><span class="line">    <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">instance</span>)&#123;</span><br><span class="line">        instance.<span class="title function_">get_flag</span>(<span class="number">4919</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ,<span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>方法一<br>Frida 的 Java.use 返回的类包装器对象（这里是 MainActivity）直接暴露了其静态成员（包括方法和字段），允许你像访问普通 JavaScript 对象的属性一样访问和调用它们。（它看起来非常像你在 Java 中直接编写 MainActivity.get_flag(4919);）<br>这个方法隐式的处理了上下文的关系，比方法二更简洁<br><class_reference>.&lt;方法&gt;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>那么实际操作就是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);</span><br><span class="line">		a.<span class="title function_">get_flag</span>(<span class="number">4919</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>方法二<br>核心是调用.call方法，此代码也可行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">MainActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[*] 主动调用。。。&quot;</span>);</span><br><span class="line">	<span class="title class_">MainActivity</span>.<span class="property">get_flag</span>.<span class="title function_">call</span>(<span class="title class_">MainActivity</span>, <span class="number">4919</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>调用<strong>静态</strong>方法时，.call 的第一个参数是<strong>类包装器</strong>；调用<strong>实例</strong>方法时，.call 的第一个参数是<strong>实例对象</strong></p>
<ul>
<li>对于 Java 的<strong>静态方法</strong>，它们不依赖于任何特定的对象实例，它们属于类本身。当你在 Frida 中使用 .call() 调用一个<strong>静态</strong> Java 方法时，你需要提供一个上下文。按照约定和实现，<strong>将类包装器本身 (MainActivity) 作为 this 上下文传递给 call 是正确的做法</strong>，它告诉 Frida 这个方法调用是针对这个类的静态上下文。</li>
</ul>
<h2 id="0x3同一个包下的不同类"><a href="#0x3同一个包下的不同类" class="headerlink" title="0x3同一个包下的不同类"></a>0x3同一个包下的不同类</h2><p>分析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x3;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (Checker.code == <span class="number">512</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>check类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x3;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Checker</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span> &#123;</span><br><span class="line">        code += <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的check不再和主方法在一个类，但是在它的运行逻辑中<br>因此不需要主动调用，只需要更改它本身逻辑<br>(这里可以对照0x1的方法三)</p>
<p>思路一<br>循环调用checker的increase()方法来递增值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">Checker</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x3.Checker&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;code当前值为&quot;</span>+<span class="title class_">Checker</span>.<span class="property">code</span>.<span class="property">value</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">Checker</span>.<span class="property">code</span>.<span class="property">value</span>=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++)&#123;</span><br><span class="line">        <span class="title class_">Checker</span>.<span class="title function_">increase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;触发函数后的值为&quot;</span>+<span class="title class_">Checker</span>.<span class="property">code</span>.<span class="property">value</span>);  </span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>思路二<br>把code直接改成512<br>修改值的模板如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> &lt;class_reference&gt; = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;&lt;package_name&gt;.&lt;class&gt;&quot;</span>);</span><br><span class="line">    &lt;class_reference&gt;.&lt;variable&gt;.<span class="property">value</span> = &lt;value&gt;;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>最终实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x3.Checker&quot;</span>);  <span class="comment">// class reference</span></span><br><span class="line">    a.<span class="property">code</span>.<span class="property">value</span> = <span class="number">512</span>;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="0x4-实例化"><a href="#0x4-实例化" class="headerlink" title="0x4 实例化"></a>0x4 实例化</h2><p>mainactivity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x4;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(C0497R.layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.f103t1 = (TextView) findViewById(C0497R.id.txtview);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>check</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x4;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Check</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get_flag</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="number">1337</span>) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(decoded);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次需要进行实例化<br><code>$new（）</code></p>
<p>模板</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> &lt;class_reference&gt; = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;&lt;package_name&gt;.&lt;class&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> &lt;class_instance&gt; = &lt;class_reference&gt;.$new(); <span class="comment">// Class Object</span></span><br><span class="line">  &lt;class_instance&gt;.&lt;method&gt;(); <span class="comment">// Calling the method</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用效果<br>这样就可以在控制台打印flag</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> check = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x4.Check&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> check_obj = check.$new(); <span class="comment">// Class Object</span></span><br><span class="line">  <span class="keyword">var</span> res = check_obj.<span class="title function_">get_flag</span>(<span class="number">1337</span>); <span class="comment">// Calling the method</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FLAG &quot;</span> + res);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这个将会直接调用新的实例化后的静态方法，传入值然后直接解密，和MainActivity没关系了</p>
<h2 id="0x5-有上下文的实例化"><a href="#0x5-有上下文的实例化" class="headerlink" title="0x5 有上下文的实例化"></a>0x5 有上下文的实例化</h2><p>主要逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x5;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(C0497R.layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.f103t1 = (TextView) findViewById(C0497R.id.textview);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flag</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (code == <span class="number">1337</span>) &#123;</span><br><span class="line">        </span><br><span class="line">	        <span class="built_in">this</span>.f103t1.setText(decryptedText);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="看起来可以模仿0x1的方法二"><a href="#看起来可以模仿0x1的方法二" class="headerlink" title="看起来可以模仿0x1的方法二"></a>看起来可以模仿0x1的方法二</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.ad2001.frida0x5.MainActivity&quot;</span>,&#123;</span><br><span class="line">    <span class="attr">onMatch</span>:<span class="keyword">function</span>(<span class="params">instance</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] 找到实例，自动触发解密&quot;</span>);</span><br><span class="line">        instance.<span class="title function_">flag</span>(<span class="number">1337</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>但是出现了报错,报错如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x5 ]-&gt;Error: java.lang.ClassNotFoundException: Didn&#x27;t find class &quot;com.ad2001.frida0x5.MainActivity&quot; on path: DexPathList[[directory &quot;.&quot;],nativeLibraryDirectories=[/system/lib64, /product/lib64, /system/lib64, /product/lib64]]       </span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:124)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:115)</span><br><span class="line">    at apply (native)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:97)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/class-factory.js:488)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:949)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:954)</span><br><span class="line">    at _make (frida/node_modules/frida-java-bridge/lib/class-factory.js:165)</span><br><span class="line">    at use (frida/node_modules/frida-java-bridge/lib/class-factory.js:62)</span><br><span class="line">    at _chooseObjectsArtPreA12 (frida/node_modules/frida-java-bridge/lib/class-factory.js:335)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/class-factory.js:303)</span><br><span class="line">    at kt (frida/node_modules/frida-java-bridge/lib/android.js:586)</span><br><span class="line">Error: java.lang.ClassNotFoundException: Didn&#x27;t find class &quot;com.ad2001.frida0x5.MainActivity&quot; on path: DexPathList[[directory &quot;.&quot;],nativeLibraryDirectories=[/system/lib64, /product/lib64, /system/lib64, /product/lib64]]       </span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:124)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:115)</span><br><span class="line">    at apply (native)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:97)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/class-factory.js:488)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:949)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:954)</span><br><span class="line">    at _make (frida/node_modules/frida-java-bridge/lib/class-factory.js:165)</span><br><span class="line">    at use (frida/node_modules/frida-java-bridge/lib/class-factory.js:62)</span><br><span class="line">    at _chooseObjectsArtPreA12 (frida/node_modules/frida-java-bridge/lib/class-factory.js:335)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/class-factory.js:303)</span><br><span class="line">    at kt (frida/node_modules/frida-java-bridge/lib/android.js:586)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>原因如下；因为 flag 方法内部执行了 this.f103t1.setText()，这是一个 UI 操作。<strong>UI 操作必须在 Android 的主线程（UI 线程）执行。</strong> 因此，你需要将调用包装在 Java.scheduleOnMainThread 中，否则可能会遇到 CalledFromWrongThreadException 错误。<br>改进后的脚本<br><strong>Hook 一个晚期方法:</strong> Hook 一个已知在 MainActivity 加载后肯定会执行的方法（例如 Activity.onResume），然后在该 Hook 内部执行 Java.choose</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">var</span> activityClass = <span class="string">&quot;com.ad2001.frida0x5.MainActivity&quot;</span>;</span><br><span class="line">	<span class="keyword">var</span> hookInstalled = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 尝试 Hook Activity 的 onResume</span></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">var</span> <span class="title class_">Activity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.Activity&quot;</span>);</span><br><span class="line">		<span class="title class_">Activity</span>.<span class="property">onResume</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[*] Activity.onResume() called. Target class should be loaded.&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 只执行一次 Java.choose</span></span><br><span class="line">			<span class="keyword">if</span> (!hookInstalled) &#123;</span><br><span class="line">				hookInstalled = <span class="literal">true</span>; <span class="comment">// 防止重复执行 choose</span></span><br><span class="line">				<span class="title class_">Java</span>.<span class="title function_">choose</span>(activityClass, &#123;</span><br><span class="line">					<span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">instance</span>) &#123;</span><br><span class="line">						<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[+] Found instance: &quot;</span> + instance + <span class="string">&quot; via onResume hook.&quot;</span>);</span><br><span class="line">						<span class="title class_">Java</span>.<span class="title function_">scheduleOnMainThread</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">							<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[*] Calling instance.flag(1337) on main thread...&quot;</span>);</span><br><span class="line">							instance.<span class="title function_">flag</span>(<span class="number">1337</span>);</span><br><span class="line">						&#125;);</span><br><span class="line">						<span class="comment">// return &#x27;stop&#x27;; // 如果只需要一个实例</span></span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">						<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[*] Java.choose search complete (triggered from onResume).&quot;</span>);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 调用原始的 onResume 方法</span></span><br><span class="line">			<span class="variable language_">this</span>.<span class="title function_">onResume</span>();</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[*] Hook installed on Activity.onResume. Waiting for activity to resume...&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[-] Failed to hook Activity.onResume: &quot;</span> + e);</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[-] Falling back to simple setTimeout...&quot;</span>);</span><br><span class="line">		<span class="comment">// 如果 Hook 失败 (例如权限问题)，回退到 setTimeout</span></span><br><span class="line">		<span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">/* ... setTimeout code from above ... */</span> &#125;, <span class="number">3000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>






<h3 id="看起来可以模仿0x2"><a href="#看起来可以模仿0x2" class="headerlink" title="看起来可以模仿0x2"></a>看起来可以模仿0x2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x5.MainActivity&quot;</span>);</span><br><span class="line">    a.<span class="title function_">flag</span>(<span class="number">1337</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>但是出现了报错，报错如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x5 ]-&gt; Error: flag: cannot call instance method without an instance</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1139)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:610)</span><br><span class="line">    at &lt;anonymous&gt; (D:\anquan_question\frida\test.js:3)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at &lt;eval&gt; (D:\anquan_question\frida\test.js:4)</span><br><span class="line">Error: flag: cannot call instance method without an instance</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1139)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:610)</span><br><span class="line">    at &lt;anonymous&gt; (D:\anquan_question\frida\test.js:3)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at &lt;eval&gt; (D:\anquan_question\frida\test.js:4)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>0x5和0x2的区别在于一个是<code>public void flag(int code)</code>而另一个是静态方法<code>public static void get_flag(int a)</code>  （差了一个<code>static</code>）<br>如果把0x5当成静态方法来处理那么就会出现很多的报错</p>
<h3 id="看起来可以模仿0x4"><a href="#看起来可以模仿0x4" class="headerlink" title="看起来可以模仿0x4"></a>看起来可以模仿0x4</h3><p>那么现在就需要调用实例化方法<br>在0x4我们为了调用get_flag实例化了Check类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x4;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Check</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get_flag</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="number">1337</span>) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(decoded);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么现在为了调用flag我们要调用MainActivity类吗</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x5;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flag</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (code == <span class="number">1337</span>) &#123;            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>这个代码是调用MainActivity的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">	<span class="keyword">let</span> <span class="title class_">MainActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x5.MainActivity&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> main = <span class="title class_">MainActivity</span>.$new();</span><br><span class="line">	main.<span class="title function_">flag</span>(<span class="number">1337</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>它出现的报错是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x5 ]-&gt; Error: flag: cannot call instance method without an instance</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1139)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:610)</span><br><span class="line">    at &lt;anonymous&gt; (D:\anquan_question\frida\test.js:3)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at &lt;eval&gt; (D:\anquan_question\frida\test.js:4)</span><br><span class="line">Error: flag: cannot call instance method without an instance</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1139)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:610)</span><br><span class="line">    at &lt;anonymous&gt; (D:\anquan_question\frida\test.js:3)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at &lt;eval&gt; (D:\anquan_question\frida\test.js:4)</span><br><span class="line">Error: java.lang.RuntimeException: Can&#x27;t create handler inside thread Thread[Thread-6,10,main] that has not called Looper.prepare()</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:124)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1237)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:643)</span><br><span class="line">    at apply (native)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1141)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:610)</span><br><span class="line">    at &lt;anonymous&gt; (D:\anquan_question\frida\test.js:4)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at &lt;eval&gt; (D:\anquan_question\frida\test.js:7)</span><br><span class="line">Error: java.lang.RuntimeException: Can&#x27;t create handler inside thread Thread[Thread-7,10,main] that has not called Looper.prepare()</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/env.js:124)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1237)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:643)</span><br><span class="line">    at apply (native)</span><br><span class="line">    at value (frida/node_modules/frida-java-bridge/lib/class-factory.js:1141)</span><br><span class="line">    at e (frida/node_modules/frida-java-bridge/lib/class-factory.js:610)</span><br><span class="line">    at &lt;anonymous&gt; (D:\anquan_question\frida\test.js:4)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at &lt;eval&gt; (D:\anquan_question\frida\test.js:7)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为什么不能<strong>实例化MainActivity</strong>?<br>由于 Android 的生命周期和线程规则，直接使用 Frida 创建 <code>MainActivity</code> 或任何 Android 组件的实例可能很棘手。Android 组件（如 <code>Activity</code> 子类）依赖于应用程序上下文才能正常运行。在 Frida 中，您可能缺少必要的上下文。Android UI 组件通常需要具有关联 <code>Looper</code> 的特定线程。如果您正在处理 UI 任务，请确保您位于具有活动 <code>Looper</code> 的主线程上。Activity 是更大的 Android 应用程序生命周期的一部分。创建 <code>MainActivity</code> 的实例可能需要应用程序处于特定状态，并且通过 Frida 管理整个生命周期可能并不简单。总之，为 <code>MainActivity</code> 创建实例不是一个好主意。<br>这里的解决方法是：<br>当 Android 应用程序启动时，系统会创建 <code>MainActivity</code> 的实例（或在 AndroidManifest.xml 文件中指定的启动器 Activity）。MainActivity 实例的创建是 Android 应用程序生命周期的一部分。因此，我们只需使用 frida 来获取 <code>MainActivity</code> 的实例，然后调用 <code>flag（）</code> 方法来获取我们的标志。</p>
<p>在这里介绍一个新的模板<br>在现有实例上调用方法<br><code>Java.performNow</code> ：用于在 Java 运行时的上下文中执行代码的函数。<br><code>Java.choose</code>：在运行时枚举指定 Java 类（作为第一个参数提供）的实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">performNow</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&#x27;&lt;Package&gt;.&lt;class_Name&gt;&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      <span class="comment">// TODO</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>onMatch</code>:<code>onMatch</code> 回调函数针对在 <code>Java.choose</code>作期间找到的指定类的每个实例执行。该回调函数接收当前实例作为其参数。可以在 <code>onMatch</code> 回调中定义要对每个实例执行的自定义操作。<br><code>onComplete</code> 回调在 <code>Java.choose</code>作完成后执行作或清理任务。此块是可选的，如果您在搜索完成后不需要执行任何特定作，则可以选择将其留空。</p>
<p>实际操作如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">performNow</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&#x27;com.ad2001.frida0x5.MainActivity&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">instance</span>) &#123; <span class="comment">// &quot;instance&quot; is the instance for the MainActivity</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Instance found&quot;</span>);</span><br><span class="line">        instance.<span class="title function_">flag</span>(<span class="number">1337</span>); <span class="comment">// Calling the function</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="0x6-实例字段"><a href="#0x6-实例字段" class="headerlink" title="0x6 实例字段"></a>0x6 实例字段</h2><p>主要逻辑如下<br>MainActivity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x6;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get_flag</span><span class="params">(Checker A)</span> <span class="keyword">throws</span> NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1234</span> == A.num1 &amp;&amp; <span class="number">4321</span> == A.num2) &#123;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Checker</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x6;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Checker</span> &#123;</span><br><span class="line">    <span class="type">int</span> num1;</span><br><span class="line">    <span class="type">int</span> num2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>这次get_flag获取的参数是Checker类，而现在要修改的是类中定义的数<br>所以现在要做的是，实例化，修改值，调用get_flag()</p>
<h3 id="看起来可以模仿0x3"><a href="#看起来可以模仿0x3" class="headerlink" title="看起来可以模仿0x3"></a>看起来可以模仿0x3</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> check = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x6.Checker&quot;</span>);  <span class="comment">// class reference</span></span><br><span class="line">    check.<span class="property">num1</span>.<span class="property">value</span> = <span class="number">1234</span>;</span><br><span class="line">    check.<span class="property">num2</span>.<span class="property">value</span> = <span class="number">4321</span>;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>报错如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Error: Cannot access an instance field without an instance</span><br><span class="line">    at set (frida/node_modules/frida-java-bridge/lib/class-factory.js:1321)</span><br><span class="line">    at &lt;anonymous&gt; (D:\anquan_question\frida\test.js:3)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOps (frida/node_modules/frida-java-bridge/index.js:250)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/index.js:225)</span><br><span class="line">    at &lt;anonymous&gt; (frida/node_modules/frida-java-bridge/lib/vm.js:12)</span><br><span class="line">    at _performPendingVmOpsWhenReady (frida/node_modules/frida-java-bridge/index.js:244)</span><br><span class="line">    at perform (frida/node_modules/frida-java-bridge/index.js:204)</span><br><span class="line">    at &lt;eval&gt; (D:\anquan_question\frida\test.js:7)</span><br></pre></td></tr></table></figure>

<p>依旧是实例和静态的问题<br>0x3是<code>static int code = 0;</code><br>0x6是<code>int num1;</code><br>不能在一个<strong>类</strong>上直接访问或修改属于<strong>实例</strong>的字段。需要先创建一个 Checker 类的<strong>对象（实例）</strong>，然后才能访问或修改那个<strong>特定对象</strong>的 num1 和 num2 字段。</p>
<p>实例化，修改值，调用get_flag()<br>现在需要实例化一个类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Checker</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x6.Checker&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> check = <span class="title class_">Checker</span>.$new();</span><br></pre></td></tr></table></figure>
<p>然后修改它的值(参照0x3)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">check.<span class="property">num1</span>.<span class="property">value</span> = <span class="number">1234</span>;</span><br><span class="line">check.<span class="property">num2</span>.<span class="property">value</span> = <span class="number">4321</span>;</span><br></pre></td></tr></table></figure>
<p>为了实例化调用get_flag,参照0x5使用框架</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">performNow</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&#x27;&lt;Package&gt;.&lt;class_Name&gt;&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">instance</span>) &#123;</span><br><span class="line">      <span class="comment">// TODO</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>实际操作如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">performNow</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&#x27;com.ad2001.frida0x6.MainActivity&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">instance</span>) &#123;</span><br><span class="line">			<span class="keyword">var</span> <span class="title class_">Checker</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x6.Checker&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> check = <span class="title class_">Checker</span>.$new();</span><br><span class="line">            check.<span class="property">num1</span>.<span class="property">value</span> = <span class="number">1234</span>;</span><br><span class="line">            check.<span class="property">num2</span>.<span class="property">value</span> = <span class="number">4321</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;get_flag called&quot;</span>);</span><br><span class="line">            instance.<span class="title function_">get_flag</span>(check);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>Java.perform vs Java.performNow 的影响:</strong> 对于这个特定的场景，Java.choose 本身就是一个需要等待匹配的操作，其 onMatch 回调是异步触发的。无论外层是 perform 还是 performNow，Java.choose 都能被正确地启动。</p>
<h2 id="0x7-构造函数-Constructor"><a href="#0x7-构造函数-Constructor" class="headerlink" title="0x7 构造函数(Constructor)"></a>0x7 构造函数(Constructor)</h2><p>主要逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x7;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="type">Checker</span> <span class="variable">ch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Checker</span>(<span class="number">123</span>, <span class="number">321</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            flag(ch);</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flag</span><span class="params">(Checker A)</span> <span class="keyword">throws</span> NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException &#123;</span><br><span class="line">        <span class="keyword">if</span> (A.num1 &gt; <span class="number">512</span> &amp;&amp; <span class="number">512</span> &lt; A.num2) &#123;</span><br><span class="line">           </span><br><span class="line">            <span class="built_in">this</span>.f103t1.setText(decrypted);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>checker</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x7;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Checker</span> &#123;</span><br><span class="line">    <span class="type">int</span> num1;</span><br><span class="line">    <span class="type">int</span> num2;</span><br><span class="line"></span><br><span class="line">    Checker(<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">        <span class="built_in">this</span>.num1 = a;</span><br><span class="line">        <span class="built_in">this</span>.num2 = b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>模板</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> &lt;class_reference&gt; = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;&lt;package_name&gt;.&lt;class&gt;&quot;</span>);</span><br><span class="line">  &lt;class_reference&gt;.<span class="property">$init</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">&lt;args&gt;</span>)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>$init</code>: 在 Frida 中，<code>$init</code> 是一个特殊的名称，用来代表 Java 类的构造函数。Java 中的构造函数名称与类名相同，但 Frida 为了提供统一的 Hook 机制，使用了 <code>$init</code> 这个标识符。</p>
<p>实际操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a =  <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);</span><br><span class="line">  a.<span class="property">$init</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">param</span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.$init(<span class="number">600</span>, <span class="number">600</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意时机<br>在 <code>onCreate</code> 方法中创建 <code>Checker</code> 类的实例，原始的 onCreate 方法会 立即 创建 Checker 对象 (new Checker(123, 321);)。在之后 尝试设置的 Checker 构造函数 Hook <strong>根本不会被触发</strong>，因为 Checker 对象已经创建完毕了。<br>所以要尽可能地早<br>要hook到oncreate，那么就要使用更快的附加方式：Spawn<code>frida -U -f 包名 -l 脚本名称</code> </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f com.ad2001.frida0x7 -l test.js</span><br></pre></td></tr></table></figure>




<p>其他思路<br>不修改原始流程，额外调用。手动创建一个新的 Checker 对象，直接给符合要求的值，主动调用找到的 MainActivity 实例的 flag 方法，传入新创建的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">performNow</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.ad2001.frida0x7.MainActivity&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">instance</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Checker</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Checker</span>_obj = <span class="title class_">Checker</span>.$new(<span class="number">513</span>, <span class="number">513</span>);</span><br><span class="line">            instance.<span class="title function_">flag</span>(<span class="title class_">Checker</span>_obj);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>用这种方法普通地附加上去就可以了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U &quot;Frida 0x7&quot; -l test.js</span><br></pre></td></tr></table></figure>

<h2 id="0x8-静态so"><a href="#0x8-静态so" class="headerlink" title="0x8 静态so"></a>0x8 静态so</h2><p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x8;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">cmpstr</span><span class="params">(String str)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;frida0x8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.cmpstr(ip);</span><br><span class="line">                <span class="keyword">if</span> (res == <span class="number">1</span>) &#123;</span><br><span class="line">                </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将程序解包得到so文件<br><code>java -jar apktool.jar d frida0x8.apk -o ./frida0x8</code><br>so</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">Java_com_ad2001_frida0x8_MainActivity_cmpstr</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [xsp+20h] [xbp-C0h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+24h] [xbp-BCh]</span></span><br><span class="line">  <span class="type">char</span> *s1; <span class="comment">// [xsp+30h] [xbp-B0h]</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">100</span>]; <span class="comment">// [xsp+74h] [xbp-6Ch] BYREF</span></span><br><span class="line">  __int64 v10; <span class="comment">// [xsp+D8h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  s1 = (<span class="type">char</span> *)_JNIEnv::GetStringUTFChars(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; __strlen_chk(<span class="string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>LL); ++i )</span><br><span class="line">    s2[i] = aGsjebObujwfMbo[i] - <span class="number">1</span>;</span><br><span class="line">  s2[__strlen_chk(<span class="string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>LL)] = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="built_in">strcmp</span>(s1, s2);</span><br><span class="line">  __android_log_print(<span class="number">3</span>, <span class="string">&quot;input &quot;</span>, <span class="string">&quot;%s&quot;</span>, s1);</span><br><span class="line">  __android_log_print(<span class="number">3</span>, <span class="string">&quot;Password&quot;</span>, <span class="string">&quot;%s&quot;</span>, s2);</span><br><span class="line">  _JNIEnv::ReleaseStringUTFChars(a1, a3, s1);</span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">  <span class="keyword">return</span> v4 == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它在这里恒返回0，而在java中它需要等于1<br>现在我们想修改<code>Java_com_ad2001_frida0x8_MainActivity_cmpstr()</code>函数，那么首先我们要找到它在哪</p>
<p>这里是几种找到函数地址的方法<br><strong>Module.enumerateExports（）</strong><br>此 API 枚举来自指定模块的所有导出 （符号） 。导出的函数由 Java 空间中的应用程序使用。它需要一个参数，该参数是要枚举其导出的模块 （共享库或可执行文件） 的名称<br>现在，让我们尝试获取 <code>cmpstr</code> 函数的地址。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x8 ]-&gt; Module.enumerateExports(&quot;libfrida0x8.so&quot;)[0]</span><br><span class="line">&#123;</span><br><span class="line">    &quot;address&quot;: &quot;0x782945e864&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;Java_com_ad2001_frida0x8_MainActivity_cmpstr&quot;,</span><br><span class="line">    &quot;type&quot;: &quot;function&quot;</span><br><span class="line">&#125;</span><br><span class="line">[Pixel 4::Frida 0x8 ]-&gt; Module.enumerateExports(&quot;libfrida0x8.so&quot;)[0][&quot;address&quot;]</span><br><span class="line">&quot;0x782945e864&quot;</span><br></pre></td></tr></table></figure>

<p><code>Module.getExportByName(modulename, exportName)</code> 函数从模块 （shared library） 中检索具有给定名称的导出元件的地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x8 ]-&gt; Module.getExportByName(&quot;libfrida0x8.so&quot;,&quot;Java_com_ad2001_frida0x8_MainActivity_cmpstr&quot;)</span><br><span class="line">&quot;0x782945e864&quot;</span><br></pre></td></tr></table></figure>

<p><code>Module.findExportByName（）</code>与 <code>Module.getExportByName（）</code> 相同。唯一的区别是，如果未找到导出， <code>则 Module.getExportByName（）</code> 会引发异常，而 <code> Module.findExportByName（）</code> 将返回 <code>null</code>。</p>
<p><code>Module.getBaseAddress（）</code> 返回给定模块的基址。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x8 ]-&gt; Module.getBaseAddress(&quot;libfrida0x8.so&quot;)</span><br><span class="line">&quot;0x782945e000&quot;</span><br></pre></td></tr></table></figure>
<p>有了基址后就只需要找到函数的偏移量，这个偏移量可以在ida里直接看到,比如cmpstr的偏移就是0x864<br>相加就是0x782945e864</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000000864</span></span><br><span class="line">.text:<span class="number">0000000000000864</span> ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:<span class="number">0000000000000864</span></span><br><span class="line">.text:<span class="number">0000000000000864</span> ; Attributes: bp-based frame</span><br><span class="line">.text:<span class="number">0000000000000864</span></span><br><span class="line">.text:<span class="number">0000000000000864</span> ; <span class="type">bool</span> __fastcall <span class="title function_">Java_com_ad2001_frida0x8_MainActivity_cmpstr</span><span class="params">(__int64, __int64, __int64)</span></span><br><span class="line">.text:0000000000000864                 EXPORT Java_com_ad2001_frida0x8_MainActivity_cmpstr</span><br><span class="line">.text:0000000000000864 Java_com_ad2001_frida0x8_MainActivity_cmpstr</span><br><span class="line">.text:0000000000000864                                         ; DATA XREF: LOAD:<span class="number">0000000000000380</span>↑o</span><br></pre></td></tr></table></figure>

<p><code>Module.enumerateImports（）</code>与 <code>Module.enumerateExports（）</code> 类似, 它将为我们提供所有模块的导入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x8 ]-&gt; Module.enumerateImports(&quot;libfrida0x8.so&quot;)</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot;: &quot;0x7914724d84&quot;,</span><br><span class="line">        &quot;module&quot;: &quot;/apex/com.android.runtime/lib64/bionic/libc.so&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;__cxa_finalize&quot;,</span><br><span class="line">        &quot;slot&quot;: &quot;0x782945fcd0&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot;: &quot;0x7914724c08&quot;,</span><br><span class="line">        &quot;module&quot;: &quot;/apex/com.android.runtime/lib64/bionic/libc.so&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;__cxa_atexit&quot;,</span><br><span class="line">        &quot;slot&quot;: &quot;0x782945fcd8&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot;: &quot;0x7914720b0c&quot;,</span><br><span class="line">        &quot;module&quot;: &quot;/apex/com.android.runtime/lib64/bionic/libc.so&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;__register_atfork&quot;,</span><br><span class="line">        &quot;slot&quot;: &quot;0x782945fce0&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot;: &quot;0x79146e8cc0&quot;,</span><br><span class="line">        &quot;module&quot;: &quot;/apex/com.android.runtime/lib64/bionic/libc.so&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;__strlen_chk&quot;,</span><br><span class="line">        &quot;slot&quot;: &quot;0x782945fcf0&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot;: &quot;0x79146bf740&quot;,</span><br><span class="line">        &quot;module&quot;: &quot;/apex/com.android.runtime/lib64/bionic/libc.so&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;strcmp&quot;,</span><br><span class="line">        &quot;slot&quot;: &quot;0x782945fcf8&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot;: &quot;0x791456f714&quot;,</span><br><span class="line">        &quot;module&quot;: &quot;/system/lib64/liblog.so&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;__android_log_print&quot;,</span><br><span class="line">        &quot;slot&quot;: &quot;0x782945fd00&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;address&quot;: &quot;0x791470d4d4&quot;,</span><br><span class="line">        &quot;module&quot;: &quot;/apex/com.android.runtime/lib64/bionic/libc.so&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;__stack_chk_fail&quot;,</span><br><span class="line">        &quot;slot&quot;: &quot;0x782945fd10&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[Pixel 4::Frida 0x8 ]-&gt; Module.enumerateImports(&quot;libfrida0x8.so&quot;)[4][&#x27;address&#x27;]</span><br><span class="line">&quot;0x79146bf740&quot;</span><br></pre></td></tr></table></figure>

<p>获取函数地址的方法知道了，现在可以开始利用函数了<br>在这里提供一个模板</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(targetAddress, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Entering &#x27;</span> + functionName);</span><br><span class="line">        <span class="comment">// Modify or log arguments if needed</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Leaving &#x27;</span> + functionName);</span><br><span class="line">        <span class="comment">// Modify or log return value if needed</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>刚开始我的尝试是直接将它的返回值改成1</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> targetSo = <span class="string">&quot;libfrida0x8.so&quot;</span>; </span><br><span class="line">    <span class="keyword">var</span> funcName = <span class="string">&quot;Java_com_ad2001_frida0x8_MainActivity_cmpstr&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> fridaretAddr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(targetSo, funcName);    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(fridaretAddr);</span><br><span class="line">    <span class="keyword">if</span> (fridaretAddr != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(fridaretAddr, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                retval.<span class="title function_">replace</span>(<span class="number">1</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;retval&quot;</span>, retval.<span class="title function_">toInt32</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>但是什么也没有发生，它只是将我的返回值改成了我的输入值，我想那不是flag<br>这是它的日志</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flame:/ # logcat | grep &quot;11156&quot;</span><br><span class="line">04-17 09:29:09.618 11156 11189 I Adreno  : PFP: 0x016ee185, ME: 0x00000000</span><br><span class="line">04-17 09:31:57.953 11156 11156 I AssistStructure: Flattened final assist data: 1372 bytes, containing 1 windows, 8 views</span><br><span class="line">04-17 09:32:10.740 11156 11156 D input   : AAA</span><br><span class="line">04-17 09:32:10.740 11156 11156 D Password: FRIDA&#123;NATIVE_LAND&#125;</span><br></pre></td></tr></table></figure>
<p>其实在日志里就解密好了<br>s2就是目标字符串，它是加密字符串，但是在和输入进行比较时会进行解密，这里也在日志里打印了解密结果</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; __strlen_chk(<span class="string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>LL); ++i )</span><br><span class="line">    s2[i] = aGsjebObujwfMbo[i] - <span class="number">1</span>;</span><br><span class="line">  s2[__strlen_chk(<span class="string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>LL)] = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="built_in">strcmp</span>(s1, s2);</span><br><span class="line">  __android_log_print(<span class="number">3</span>, <span class="string">&quot;input &quot;</span>, <span class="string">&quot;%s&quot;</span>, s1);</span><br><span class="line">  __android_log_print(<span class="number">3</span>, <span class="string">&quot;Password&quot;</span>, <span class="string">&quot;%s&quot;</span>, s2);</span><br></pre></td></tr></table></figure>
<p>到这里就解出题目了</p>
<p>换个思路<br>我们要使res&#x3D;1，那么就要输入和它想要对比的字符一样的字符串，那么和我们进行对比的字符串是什么呢？我们能获取到strcmp函数的第二个参数，也就是和我们输入进行对比的字符吗？</p>
<p>先查找strcmp都在什么地方出现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strcmp_adr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libfrida0x8.so&quot;</span>, <span class="string">&quot;strcmp&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(strcmp_adr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hooking the strcmp function&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>出来了很多结果<br>那么怎么定位我们的目标strcmp函数（和我们的输入相关联的strcmp)<br>可以肯定目标strcmp和其他strcmp不同的地方就在于传入的参数不同<br>那么现在来查找函数的参数</p>
<p>函数声明如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">strcmp</span><span class="params">( <span class="type">const</span> <span class="type">char</span> *string1, <span class="type">const</span> <span class="type">char</span> *string2 )</span>;</span><br></pre></td></tr></table></figure>
<p>使用 <code>Memory.readUtf8String（） API</code>。它使用提供的地址从内存中读取 <code>utf</code> 字符串。<code>args</code> 是一个指针数组，其中包含 <code>strcmp</code> 函数的参数。因此，要访问第一个参数，我们可以使用 <code>arg[0]。</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strcmp_adr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;strcmp&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(strcmp_adr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="comment">//console.log(&quot;try find args&quot;);</span></span><br><span class="line">        <span class="keyword">var</span> arg0 = <span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(arg0);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这是其中一部分数据，看来调用strcmp的方法很多</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x8 ]-&gt; Ljava/lang/String;</span><br><span class="line">Lcom/android/internal/telephony/ProxyController;</span><br><span class="line"><span class="meta prompt_">Lcom/android/internal/view/IInputMethodClient$</span><span class="language-bash">Stub;</span></span><br><span class="line">Lcom/android/internal/telephony/PhoneSubInfoController;</span><br><span class="line">Landroid/view/View;</span><br><span class="line"><span class="meta prompt_">Landroid/view/autofill/AutofillManager$</span><span class="language-bash">AutofillClient;</span></span><br><span class="line"><span class="meta prompt_">Landroid/net/Uri$</span><span class="language-bash">HierarchicalUri;</span></span><br><span class="line">Landroid/os/UserHandle;</span><br><span class="line">Ljava/lang/Object;</span><br><span class="line"><span class="meta prompt_">Lcom/android/internal/telephony/euicc/EuiccConnector$</span><span class="language-bash">AvailableState;</span></span><br><span class="line"><span class="meta prompt_">Lcom/android/i18n/phonenumbers/Phonemetadata$</span><span class="language-bash">NumberFormat;</span></span><br><span class="line">Landroid/content/IContentProvider;</span><br><span class="line">Landroid/os/Bundle;</span><br><span class="line">Ljava/lang/String;</span><br><span class="line">Ljava/lang/String;</span><br></pre></td></tr></table></figure>
<p>第一个参数是我们输入的参数，那么现在进行过滤<br>现在输入hello，来确认目标地址</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strcmp_adr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;strcmp&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(strcmp_adr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> arg0 = <span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span> (arg0.<span class="title function_">includes</span>(<span class="string">&quot;hello&quot;</span>)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(arg0);</span><br><span class="line">            <span class="comment">//console.log(strcmp_adr);</span></span><br><span class="line">            <span class="comment">//获取指定strcmp地址</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>现在得到的数据就只有一条</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x8 ]-&gt; hello</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后按照之前的方法获取第二个参数<code>Memory.readUtf8String(args[1]);</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strcmp_adr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;strcmp&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(strcmp_adr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> arg0 = <span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">var</span> arg1 = <span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>(args[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (arg0.<span class="title function_">includes</span>(<span class="string">&quot;hello&quot;</span>)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(arg0);</span><br><span class="line">            <span class="comment">//console.log(strcmp_adr);</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(arg1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0x8 ]-&gt; hello</span><br><span class="line">FRIDA&#123;NATIVE_LAND&#125;</span><br></pre></td></tr></table></figure>


<h2 id="0x9-修改静态so返回值"><a href="#0x9-修改静态so返回值" class="headerlink" title="0x9 修改静态so返回值"></a>0x9 修改静态so返回值</h2><p>主要逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.a0x9;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">check_flag</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;a0x9&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    stener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;             </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (MainActivity.<span class="built_in">this</span>.check_flag() == <span class="number">1337</span>) &#123;</span><br><span class="line">                    </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>so</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__int64 Java_com_ad2001_a0x9_MainActivity_check_1flag()</span><br><span class="line">&#123;</span><br><span class="line">  return 1LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单的修改返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flag_adr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;liba0x9.so&quot;</span>, <span class="string">&quot;Java_com_ad2001_a0x9_MainActivity_check_1flag&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(flag_adr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;catch the flag&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="comment">//retval = 1337;//错误的赋值</span></span><br><span class="line">        retval.<span class="title function_">replace</span>(<span class="number">1337</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;change the result&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>模板</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(targetAddress, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Entering &#x27;</span> + functionName);</span><br><span class="line">        <span class="comment">// 修改参数</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Leaving &#x27;</span> + functionName);</span><br><span class="line">        <span class="comment">// 修改返回值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的函数名不是check_flag而是check_1flag,这和jni的命名规则有关，特殊转义，下划线 <code>_</code>** → <code>_1</code></p>
<h2 id="0xA-动态so"><a href="#0xA-动态so" class="headerlink" title="0xA 动态so"></a>0xA 动态so</h2><p>java</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">ad2001</span>.<span class="property">frida0xa</span>;</span><br><span class="line"></span><br><span class="line">public final <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AppCompatActivity</span> &#123;</span><br><span class="line">    public final native <span class="title class_">String</span> <span class="title function_">stringFromJNI</span>();</span><br><span class="line">        protected <span class="keyword">void</span> <span class="title function_">onCreate</span>(<span class="params">Bundle savedInstanceState</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        activityMainBinding.<span class="property">sampleText</span>.<span class="title function_">setText</span>(<span class="title function_">stringFromJNI</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="title function_">loadLibrary</span>(<span class="string">&quot;frida0xa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>so</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_com_ad2001_frida0xa_MainActivity_stringFromJNI</span><span class="params">(_JNIEnv *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v1; <span class="comment">// x0</span></span><br><span class="line">  __int64 v3; <span class="comment">// [xsp+18h] [xbp-48h]</span></span><br><span class="line">  _BYTE v5[<span class="number">24</span>]; <span class="comment">// [xsp+40h] [xbp-20h] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [xsp+58h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;decltype(nullptr)&gt;();</span><br><span class="line">  v1 = (<span class="type">const</span> <span class="type">char</span> *)sub_1DD3C(v5);</span><br><span class="line">  v3 = _JNIEnv::NewStringUTF(a1, v1);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v5);</span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前面这两个主要是把文本 “Hello Hackers”显示在我们的 <code>TextView</code> 中。<br>继续找<br>然后在so这里找到了get_flag()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">get_flag</span><span class="params">(__int64 result, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+Ch] [xbp-44h]</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">20</span>]; <span class="comment">// [xsp+34h] [xbp-1Ch] BYREF</span></span><br><span class="line">  __int64 v4; <span class="comment">// [xsp+48h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)result + a2 == <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; __strlen_chk(<span class="string">&quot;FPE&gt;9q8A&gt;BK-)20A-#Y&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>LL); ++i )</span><br><span class="line">      v3[i] = aFpe9q8aBk20aY[i] + <span class="number">2</span> * i;</span><br><span class="line">    v3[<span class="number">19</span>] = <span class="number">0</span>;</span><br><span class="line">    result = __android_log_print(<span class="number">3</span>, <span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;Decrypted Flag: %s&quot;</span>, v3);</span><br><span class="line">  &#125;</span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它会把最终的flag打印<code>result = __android_log_print(3, &quot;FLAG&quot;, &quot;Decrypted Flag: %s&quot;, v3);</code>在日志里</p>
<p>接下来分析get_flag(),两个参数相加等于3</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_flag(__int64 result, <span class="type">int</span> a2)</span><br><span class="line"><span class="keyword">if</span> ( (_DWORD)result + a2 == <span class="number">3</span> )</span><br></pre></td></tr></table></figure>

<p>接下来就是怎么hook动态注册的函数，并且修改函数的参数值</p>
<p>get_flag()这个名字看起来就是动态注册的，静态注册的命名很特别：<code>Java_&#123;PackageName&#125;_&#123;ClassName&#125;_&#123;MethodName&#125;</code></p>
<p>尝试导出函数，它也不在可导出列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Pixel 4::Frida 0xA ]-&gt; Module.findExportByName(&quot;libfrida0xa.so&quot;, &quot;Java_com_ad2001_frida0xa_MainActivity_stringF </span><br><span class="line">romJNI&quot;)</span><br><span class="line">&quot;0x72e0b0fbe0&quot;</span><br><span class="line">[Pixel 4::Frida 0xA ]-&gt; Module.findExportByName(&quot;libfrida0xa.so&quot;, &quot;get_flag&quot;)</span><br><span class="line">null</span><br></pre></td></tr></table></figure>

<p>使用0x8控制静态方法的模板不可行</p>
<p>这里给个新的模板</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> native_adr = <span class="keyword">new</span> <span class="title class_">NativePointer</span>(&lt;address_of_the_native_function&gt;);</span><br><span class="line"><span class="keyword">const</span> native_function = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(native_adr, <span class="string">&#x27;&lt;return type&gt;&#x27;</span>, [<span class="string">&#x27;argument_data_type&#x27;</span>]);</span><br><span class="line"><span class="title function_">native_function</span>(&lt;<span class="variable language_">arguments</span>&gt;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> native_adr = <span class="keyword">new</span> <span class="title class_">NativePointer</span>(&lt;address_of_the_native_function&gt;);</span><br></pre></td></tr></table></figure>
<p>要在 frida 中调用native函数，我们需要一个 <code>NativePointer</code> 对象。我们应该将要调用的原生函数的地址传递给 NativePointer 构造函数。接下来，我们将创建 <code>NativeFunction</code> 对象 ，它表示我们想要调用的实际原生函数。它围绕原生函数创建了一个 JavaScript 包装器，允许我们从 frida 调用该原生函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> native_function = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(native_adr, <span class="string">&#x27;&lt;return type&gt;&#x27;</span>, [<span class="string">&#x27;argument_data_type&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>第一个参数应该是 <code>NativePointer</code> 对象，第二个参数是原生函数的返回类型，第三个参数是要传递给原生函数的参数的数据类型列表。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">native_function</span>(&lt;<span class="variable language_">arguments</span>&gt;);</span><br></pre></td></tr></table></figure>
<p>接着就可以调用定义好的方法了</p>
<p>那么如何查找动态注册的native的地址呢？<br>打开ida查看它的偏移,可以得到偏移为0x1DD60</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000001</span>DD5C                 RET</span><br><span class="line">.text:<span class="number">000000000001</span>DD5C ; &#125; <span class="comment">// starts at 1DD3C</span></span><br><span class="line">.text:<span class="number">000000000001</span>DD5C ; End of function sub_1DD3C</span><br><span class="line">.text:<span class="number">000000000001</span>DD5C</span><br><span class="line">.text:<span class="number">000000000001</span>DD60</span><br><span class="line">.text:<span class="number">000000000001</span>DD60 ; =============== S U B R O U T I N E =======================================</span><br><span class="line">.text:<span class="number">000000000001</span>DD60</span><br><span class="line">.text:<span class="number">000000000001</span>DD60 ; Attributes: bp-based frame</span><br><span class="line">.text:<span class="number">000000000001</span>DD60</span><br><span class="line">.text:<span class="number">000000000001</span>DD60 ; __int64 __fastcall <span class="title function_">get_flag</span><span class="params">(__int64 result, <span class="type">int</span>)</span></span><br><span class="line">.text:000000000001DD60                 EXPORT _Z8get_flagii</span><br><span class="line">.text:000000000001DD60 _Z8get_flagii                           ; DATA XREF: LOAD:<span class="number">0000000000001648</span>↑o</span><br></pre></td></tr></table></figure>
<p>所在库就是基址<br>找到libfrida0xa.so的基址<br><code>var base = Module.findBaseAddress(&quot;libfrida0xa.so&quot;);</code><br>然后加上偏移<br><code>var flag_adr = base.add(0x1DD60);</code><br>就得到了目标地址</p>
<p>具体操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xa.so&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> flag_adr = base.<span class="title function_">add</span>(<span class="number">0x1DD60</span>);</span><br><span class="line"><span class="keyword">var</span> native_adr = <span class="keyword">new</span> <span class="title class_">NativePointer</span>(flag_adr);  <span class="comment">//创建NativePointer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建NativeFunction</span></span><br><span class="line"><span class="keyword">const</span> get_flag = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(native_adr, <span class="string">&#x27;void&#x27;</span>, [<span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="title function_">get_flag</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>在日志里看到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> :&gt;frida-ps -Uai</span><br><span class="line">  PID  Name                 Identifier</span><br><span class="line">-----  -------------------  ---------------------------------------</span><br><span class="line">19645  frida 0xA            com.ad2001.frida0xa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flame:/ # logcat | grep &quot;19645&quot;</span><br><span class="line">04-17 10:12:22.425 19645 19692 D ProfileInstaller: Installing profile for com.ad2001.frida0xa</span><br><span class="line">04-17 10:23:42.752 19645 19691 D FLAG    : Decrypted Flag: FRIDA&#123;DONT_CALL_ME&#125;</span><br><span class="line">04-17 10:23:43.537 19645 19691 D FLAG    : Decrypted Flag: FRIDA&#123;DONT_CALL_ME&#125;</span><br></pre></td></tr></table></figure>

<h2 id="0xB-加花的so"><a href="#0xB-加花的so" class="headerlink" title="0xB 加花的so"></a>0xB 加花的so</h2><p>主要逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0xb;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">getFlag</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        btn.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; </span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                MainActivity.onCreate$lambda$<span class="number">0</span>(MainActivity.<span class="built_in">this</span>, view);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> onCreate$lambda$<span class="number">0</span>(MainActivity <span class="built_in">this</span>$<span class="number">0</span>, View it) &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(<span class="built_in">this</span>$<span class="number">0</span>, <span class="string">&quot;this$0&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>$<span class="number">0.</span>getFlag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;frida0xb&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>so</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title class_">Java</span>_com_ad2001_frida0xb_MainActivity_getFlag()</span><br><span class="line">&#123;</span><br><span class="line">  ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这次的so反编译结果什么也没有<br>那么尝试手动分析其逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000015220</span></span><br><span class="line">.text:<span class="number">0000000000015220</span> ; __unwind &#123;</span><br><span class="line">.text:<span class="number">0000000000015220</span>                 SUB             SP, SP, #<span class="number">0x60</span></span><br><span class="line">.text:<span class="number">0000000000015224</span>                 STP             X29, X30, [SP,#<span class="number">0x50</span>+var_s0]</span><br><span class="line">.text:<span class="number">0000000000015228</span>                 ADD             X29, SP, #<span class="number">0x50</span></span><br><span class="line">.text:<span class="number">000000000001522</span>C                 STUR            X0, [X29,#var_18]</span><br><span class="line">.text:<span class="number">0000000000015230</span>                 STUR            X1, [X29,#var_20]</span><br><span class="line">.text:<span class="number">0000000000015234</span>                 MOV             W8, #<span class="number">0xDEADBEEF</span></span><br><span class="line">.text:<span class="number">000000000001523</span>C                 STUR            W8, [X29,#var_24]</span><br><span class="line">.text:<span class="number">0000000000015240</span>                 LDUR            W8, [X29,#var_24]</span><br><span class="line">.text:<span class="number">0000000000015244</span>                 SUBS            W8, W8, #<span class="number">0x539</span></span><br><span class="line">.text:<span class="number">0000000000015248</span>                 B.NE            loc_1532C</span><br><span class="line">.text:<span class="number">000000000001524</span>C                 B               loc_15250</span><br><span class="line">.text:<span class="number">0000000000015250</span> ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">0000000000015250</span></span><br><span class="line">.text:<span class="number">0000000000015250</span> loc_15250                               ; CODE XREF: Java_com_ad2001_frida0xb_MainActivity_getFlag+<span class="number">2</span>C↑j</span><br><span class="line">.text:<span class="number">0000000000015250</span>                 STR             XZR, [SP,#<span class="number">0x50</span>+var_30]</span><br><span class="line">.text:<span class="number">0000000000015254</span>                 ADRL            X8, aJEhmwbmxezisdm ; <span class="string">&quot;j~ehmWbmxezisdmogi~Q&quot;</span></span><br><span class="line">.text:<span class="number">000000000001525</span>C                 STR             X8, [SP,#<span class="number">0x50</span>+var_38]</span><br><span class="line">.text:<span class="number">0000000000015260</span>                 LDR             X8, [SP,#<span class="number">0x50</span>+var_38]</span><br><span class="line">.text:<span class="number">0000000000015264</span>                 STUR            X8, [X29,#var_8]</span><br><span class="line">.text:<span class="number">0000000000015268</span>                 MOV             X8, #<span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">.text:<span class="number">000000000001526</span>C                 STUR            X8, [X29,#var_10]</span><br><span class="line">.text:<span class="number">0000000000015270</span>                 LDUR            X0, [X29,#var_8] ; <span class="type">char</span> *</span><br><span class="line">.text:<span class="number">0000000000015274</span>                 LDUR            X1, [X29,#var_10] ; <span class="type">size_t</span></span><br><span class="line">.text:<span class="number">0000000000015278</span>                 BL              .__strlen_chk</span><br><span class="line">.text:<span class="number">000000000001527</span>C                 STR             X0, [SP,#<span class="number">0x50</span>+var_40]</span><br><span class="line">.text:<span class="number">0000000000015280</span>                 LDR             X8, [SP,#<span class="number">0x50</span>+var_40]</span><br><span class="line">.text:<span class="number">0000000000015284</span>                 ADD             X0, X8, #<span class="number">1</span> ; <span class="type">unsigned</span> __int64</span><br><span class="line">.text:<span class="number">0000000000015288</span>                 BL              ._Znam  ; operator new[](ulong)</span><br><span class="line">.text:<span class="number">000000000001528</span>C                 STR             X0, [SP,#<span class="number">0x50</span>+var_48]</span><br><span class="line">.text:<span class="number">0000000000015290</span>                 STR             XZR, [SP,#<span class="number">0x50</span>+var_30]</span><br><span class="line">.text:<span class="number">0000000000015294</span>                 B               loc_15298</span><br></pre></td></tr></table></figure>
<p>这是一个关键跳转</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000015248</span>                 B.NE            loc_1532C</span><br><span class="line">.text:<span class="number">000000000001524</span>C                 B               loc_15250</span><br></pre></td></tr></table></figure>
<p>loc_1532c会直接跳到末尾结束函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000001532</span>C ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">000000000001532</span>C</span><br><span class="line">.text:<span class="number">000000000001532</span>C loc_1532C                               ; CODE XREF: Java_com_ad2001_frida0xb_MainActivity_getFlag+<span class="number">28</span>↑j</span><br><span class="line">.text:<span class="number">000000000001532</span>C                                         ; Java_com_ad2001_frida0xb_MainActivity_getFlag:loc_15328↑j</span><br><span class="line">.text:<span class="number">000000000001532</span>C                 LDP             X29, X30, [SP,#<span class="number">0x50</span>+var_s0]</span><br><span class="line">.text:<span class="number">0000000000015330</span>                 ADD             SP, SP, #<span class="number">0x60</span> ; <span class="string">&#x27;`&#x27;</span></span><br><span class="line">.text:<span class="number">0000000000015334</span>                 RET</span><br><span class="line">.text:<span class="number">0000000000015334</span> ; &#125; <span class="comment">// starts at 15220</span></span><br><span class="line">.text:<span class="number">0000000000015334</span> ; End of function Java_com_ad2001_frida0xb_MainActivity_getFlag</span><br><span class="line">.text:<span class="number">0000000000015334</span></span><br></pre></td></tr></table></figure>
<p>而loc_15250会执行一段解密逻辑并正常走完函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000015250</span> loc_15250                               ; CODE XREF: Java_com_ad2001_frida0xb_MainActivity_getFlag+<span class="number">2</span>C↑j</span><br><span class="line">.text:<span class="number">0000000000015250</span>                 STR             XZR, [SP,#<span class="number">0x50</span>+var_30]</span><br><span class="line">.text:<span class="number">0000000000015254</span>                 ADRL            X8, aJEhmwbmxezisdm ; <span class="string">&quot;j~ehmWbmxezisdmogi~Q&quot;</span></span><br><span class="line">.text:<span class="number">000000000001525</span>C                 STR             X8, [SP,#<span class="number">0x50</span>+var_38]</span><br><span class="line">.text:<span class="number">0000000000015260</span>                 LDR             X8, [SP,#<span class="number">0x50</span>+var_38]</span><br><span class="line">.text:<span class="number">0000000000015264</span>                 STUR            X8, [X29,#var_8]</span><br><span class="line">.text:<span class="number">0000000000015268</span>                 MOV             X8, #<span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">.text:<span class="number">000000000001526</span>C                 STUR            X8, [X29,#var_10]</span><br><span class="line">.text:<span class="number">0000000000015270</span>                 LDUR            X0, [X29,#var_8] ; <span class="type">char</span> *</span><br><span class="line">.text:<span class="number">0000000000015274</span>                 LDUR            X1, [X29,#var_10] ; <span class="type">size_t</span></span><br><span class="line">.text:<span class="number">0000000000015278</span>                 BL              .__strlen_chk</span><br><span class="line">.text:<span class="number">000000000001527</span>C                 STR             X0, [SP,#<span class="number">0x50</span>+var_40]</span><br><span class="line">.text:<span class="number">0000000000015280</span>                 LDR             X8, [SP,#<span class="number">0x50</span>+var_40]</span><br><span class="line">.text:<span class="number">0000000000015284</span>                 ADD             X0, X8, #<span class="number">1</span> ; <span class="type">unsigned</span> __int64</span><br><span class="line">.text:<span class="number">0000000000015288</span>                 BL              ._Znam  ; operator new[](ulong)</span><br><span class="line">.text:<span class="number">000000000001528</span>C                 STR             X0, [SP,#<span class="number">0x50</span>+var_48]</span><br><span class="line">.text:<span class="number">0000000000015290</span>                 STR             XZR, [SP,#<span class="number">0x50</span>+var_30]</span><br><span class="line">.text:<span class="number">0000000000015294</span>                 B               loc_15298</span><br><span class="line">.text:<span class="number">0000000000015298</span> ; ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>那么现在的解题思路就是：<br>1.nop掉<code>.text:0000000000015248                 B.NE            loc_1532C</code><br>2.将它替换成<code>.text:000000000001524C                 B               loc_15250</code></p>
<p>B.NE代表Branch if Not Equal，也就是当两个操作数不相等时才会跳转<br>B代表跳转</p>
<p>修改内存:<a class="link"   target="_blank" rel="noopener" href="https://learnfrida.info/advanced_usage/#patching-memory" >https://learnfrida.info/advanced_usage/#patching-memory<i class="fas fa-external-link-alt"></i></a><br>patchcode<br><code>Memory.patchCode</code> API 允许我们修改 <code>X</code> 地址处的 <code>N</code> 个字节，该地址以 <code>NativePointer</code> 的形式给出，此指针必须是可写的，以便我们对其进行修改。在某些系统（如 iOS）中，地址指针在映射到内存之前会写入临时位置。因此，代码编写者的第一个参数应该是 <code>code</code> 参数，而不是 <code>openPtr</code>）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Memory</span>.<span class="title function_">patchCode</span>(openPtr, <span class="title class_">Process</span>.<span class="property">pageSize</span>, <span class="keyword">function</span> (<span class="params">code</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> cw = <span class="keyword">new</span> <span class="title function_">X86Writer</span>(code, &#123; <span class="attr">pc</span>: openPtr &#125;);</span><br><span class="line">	cw.<span class="title function_">putNopPadding</span>(<span class="title class_">Process</span>.<span class="property">pageSize</span>);</span><br><span class="line">	cw.<span class="title function_">putRet</span>();</span><br><span class="line">	cw.<span class="title function_">flush</span>();</span><br><span class="line">&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>这里是X86Writer,不同的架构要使用不同的方法，我的手机是Arm架构，在这里我用的是Arm64Writer<br>可以查看api:<a class="link"   target="_blank" rel="noopener" href="https://frida.re/docs/javascript-api/#x86writer" >https://frida.re/docs/javascript-api/#x86writer<i class="fas fa-external-link-alt"></i></a></p>
<p>实际操作如下<br>按照之前的方法找到<code>loc_1532C</code>地址，然后进行patch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> libbase = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xb.so&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> jmp = libbase.<span class="title function_">add</span>(<span class="number">0x15248</span>);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">patchCode</span>(jmp, <span class="number">4</span>, <span class="keyword">function</span> (<span class="params">code</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> cw = <span class="keyword">new</span> <span class="title class_">Arm64Writer</span>(code, &#123; <span class="attr">pc</span>: jmp &#125;);</span><br><span class="line">	cw.<span class="title function_">putNop</span>(); <span class="comment">//进行nop替换</span></span><br><span class="line">	cw.<span class="title function_">flush</span>();</span><br><span class="line">&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>另一个模板</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> writer = <span class="keyword">new</span> <span class="title function_">X86Writer</span>(&lt;address_of_the_instruction&gt;);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// Insert instructions</span></span><br><span class="line">  <span class="comment">// Flush the changes to memory</span></span><br><span class="line">  writer.<span class="title function_">flush</span>();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">  <span class="comment">// Dispose of the X86Writer to free up resources</span></span><br><span class="line">  writer.<span class="title function_">dispose</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于flush():<br>调用 <code>flush</code> 方法将更改应用于内存。这可确保将修改后的指令写入内存位置。</p>
<p><code>finally</code> 块用于确保 <code>X86Writer</code> 资源得到正确清理。调用 <code>dispose</code> 方法释放 <code>X86Writer</code> 实例关联的资源。<br>此模板是x86,因此如果我要用在我自己的手机上我需要对其进行更改</p>
<p>现在来看方法二，替换指令</p>
<ul>
<li><code>putBImm(target)</code>: put a B instruction<br>2.将它替换成<code>.text:000000000001524C                 B               loc_15250</code><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> libbase = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xb.so&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> jmp = libbase.<span class="title function_">add</span>(<span class="number">0x15248</span>);</span><br><span class="line"><span class="keyword">var</span> target = libbase.<span class="title function_">add</span>(<span class="number">0x1524c</span>);</span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">patchCode</span>(jmp, <span class="number">4</span>, <span class="keyword">function</span> (<span class="params">code</span>) &#123;</span><br><span class="line">	<span class="keyword">const</span> cw = <span class="keyword">new</span> <span class="title class_">Arm64Writer</span>(code, &#123; <span class="attr">pc</span>: jmp &#125;);</span><br><span class="line">	<span class="comment">//cw.putNop();</span></span><br><span class="line">	cw.<span class="title function_">putBImm</span>(target);</span><br><span class="line">	cw.<span class="title function_">flush</span>();</span><br><span class="line">&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>另一种写法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> adr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xb.so&quot;</span>).<span class="title function_">add</span>(<span class="number">0x15248</span>);  <span class="comment">// Addres of the b.ne instruction</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(adr, <span class="number">0x1000</span>, <span class="string">&quot;rwx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> writer = <span class="keyword">new</span> <span class="title class_">Arm64Writer</span>(adr);  <span class="comment">// ARM64 writer object</span></span><br><span class="line"><span class="keyword">var</span> target = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xb.so&quot;</span>).<span class="title function_">add</span>(<span class="number">0x1524c</span>);  <span class="comment">// Address of the next instruction  b  LAB_00115250</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  writer.<span class="title function_">putBImm</span>(target);   <span class="comment">// Inserts the &lt;b target&gt; instruction in the place of b.ne instruction</span></span><br><span class="line">  writer.<span class="title function_">flush</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Branch instruction inserted at <span class="subst">$&#123;adr&#125;</span>`</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">  writer.<span class="title function_">dispose</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="修改内存权限"><a href="#修改内存权限" class="headerlink" title="修改内存权限"></a>修改内存权限</h3><p>“此指针必须是可写的”<br>所以如果该页权限受限就可能无法正常patch,这个时候就需要进行权限修改<br><code>Memory.protect</code> 函数的语法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(address, size, protection);</span><br></pre></td></tr></table></figure>
<p><code>address</code>：用于更改保护的内存区域的起始地址。<br><code>size</code>：内存区域的大小（以字节为单位）。<br><code>protection</code>：内存区域的保护属性。</p>
<p>通常需要指定一个页的大小</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(jnz, <span class="number">0x1000</span>, <span class="string">&quot;rwx&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>这句单独写在外面，这个是x86的利用脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jnz = <span class="title class_">Module</span>.<span class="title function_">getBaseAddress</span>(<span class="string">&quot;libfrida0xb.so&quot;</span>).<span class="title function_">add</span>(<span class="number">0x20e2a</span> - <span class="number">0x00010000</span>);</span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(jnz, <span class="number">0x1000</span>, <span class="string">&quot;rwx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> writer = <span class="keyword">new</span> <span class="title function_">X86Writer</span>(jnz);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  writer.<span class="title function_">putNop</span>()</span><br><span class="line">  writer.<span class="title function_">putNop</span>()</span><br><span class="line">  writer.<span class="title function_">putNop</span>()</span><br><span class="line">  writer.<span class="title function_">putNop</span>()</span><br><span class="line">  writer.<span class="title function_">putNop</span>()</span><br><span class="line">  writer.<span class="title function_">putNop</span>()</span><br><span class="line"></span><br><span class="line">  writer.<span class="title function_">flush</span>();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">  writer.<span class="title function_">dispose</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字节对齐"><a href="#字节对齐" class="headerlink" title="字节对齐"></a>字节对齐</h3><p>ARM64的nop是4字节，x86的nop是一字节</p>
<ul>
<li><p><strong>ARM64 (A64 指令集):</strong></p>
<ul>
<li><strong>架构类型:</strong> RISC (精简指令集计算) 风格。虽然现代 ARM 很复杂，但 A64 保留了 RISC 的一些关键特性。</li>
<li><strong>指令长度:</strong> **固定长度 (Fixed-Length)**。所有 A64 指令都是 <strong>4 字节 (32位)</strong> 长。</li>
<li><strong>对齐要求:</strong> 指令<strong>必须</strong>存储在 4 字节对齐的地址上。CPU 总是从 4 字节对齐的地址开始，一次读取 4 个字节作为一条指令进行解码。</li>
</ul>
</li>
<li><p><strong>x86 &#x2F; x86-64:</strong></p>
<ul>
<li><strong>架构类型:</strong> CISC (复杂指令集计算) 风格。</li>
<li><strong>指令长度:</strong> **可变长度 (Variable-Length)**。x86 指令的长度可以从 <strong>1 字节到 15 字节</strong>不等。指令的第一个字节（或几个字节）通常包含操作码 (Opcode)，后续字节可能包含操作数、寻址模式信息或前缀等。</li>
<li><strong>对齐要求:</strong> 指令可以从<strong>任何字节地址</strong>开始。虽然处理器为了性能也喜欢对齐的指令（特别是跳转目标），但硬件设计必须能够处理从任意字节边界开始的指令。</li>
</ul>
</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   target="_blank" rel="noopener" href="https://github.com/DERE-ad2001/Frida-Labs/" >https://github.com/DERE-ad2001/Frida-Labs/<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="https://learnfrida.info/advanced_usage/" >https://learnfrida.info/advanced_usage/<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="https://codeshare.frida.re/" >https://codeshare.frida.re/<i class="fas fa-external-link-alt"></i></a></p>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                Frida-Labs wp
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2025/04/17/Frida-Labs-wp/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    作者
                </div>
                <div class="content">arch3rn4r</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    发布于
                </div>
                <div class="content">2025-04-17 11:37</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    许可
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="复制版权信息" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="分享到 QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="分享到微信"
            data-tooltip-img-tip="微信扫一扫"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="分享到微博"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2025/04/19/%E5%9F%BA%E4%BA%8ELAN%E7%9A%84intent%E8%A7%A6%E5%8F%91/"
                                   title="基于LAN的intent触发"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">基于LAN的intent触发</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2025/03/02/frida%E7%BB%95%E8%BF%87%E6%A3%80%E6%B5%8B%E5%AD%A6%E4%B9%A0/"
                                   title="frida绕过检测学习"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">frida绕过检测学习</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    


    <div class="comments-container border-box">
        <div id="comments-anchor" class="comment-area-title border-box">
            <i class="fas fa-comments"></i>&nbsp;评论
        </div>
        <div class="comment-plugin-fail border-box">
    <span class="fail-tip">评论插件加载失败</span>
    <button class="reload keep-button">点击重新加载</button>
</div>
<div class="comment-plugin-loading flex-center border-box">
    <i class="loading-icon fa-solid fa-spinner fa-spin"></i>
    <span class="load-tip">正在加载评论插件</span>
</div>
<script data-pjax>
  window.KeepCommentPlugin = {}
  window.KeepCommentPlugin.hideLoading = () => {
    const cplDom = document.querySelector('.comments-container .comment-plugin-loading')
    cplDom.style.display = 'none'
  }
  window.KeepCommentPlugin.loadFailHandle = () => {
    window.KeepCommentPlugin.hideLoading()
    const cpfDom = document.querySelector('.comments-container .comment-plugin-fail')
    cpfDom.style.display = 'flex'
    cpfDom.querySelector('.reload').addEventListener('click', () => {
      window.location.reload()
    })
  }
</script>

        
            

    <div class="giscus-comments-container">
        <div class="giscus" id="giscus"></div>
        <script 
                onerror="window.KeepCommentPlugin.loadFailHandle()"
        >
          if (!window.KeepCommentPlugin?.getGiscusTheme) {
            window.KeepCommentPlugin.getGiscusTheme = () => {
              return document.documentElement.classList.contains('dark-mode') ? 'dark_dimmed' : 'light_tritanopia'
            }
          }

          if (!window.KeepCommentPlugin?.changeGiscusTheme) {
            window.KeepCommentPlugin.changeGiscusTheme = () => {
              const iframe = document.querySelector('iframe.giscus-frame')
              iframe && iframe.contentWindow.postMessage({
                giscus: {
                  setConfig: {
                    theme: window.KeepCommentPlugin.getGiscusTheme()
                  }
                }
              }, 'https://giscus.app')
            }
          }

          if (!window.KeepCommentPlugin?.initGiscus) {
            window.KeepCommentPlugin.initGiscus = () => {
              const script = document.createElement('script')
              script.async = true
              script.src = 'https://giscus.app/client.js'
              script.setAttribute('data-repo', 'arch3rn4r/arch3rn4r.github.io')
              script.setAttribute('data-repo-id', 'R_kgDOLnMFhw')
              script.setAttribute('data-category', 'Announcements')
              script.setAttribute('data-category-id', 'DIC_kwDOLnMFh84Cik-D')
              script.setAttribute('data-reactions-enabled', '0')
              script.setAttribute('data-lang', 'zh-CN')
              script.setAttribute('data-mapping', 'pathname')
              script.setAttribute('data-strict', '0')
              script.setAttribute('data-emit-metadata', '0')
              script.setAttribute('data-input-position', 'top')
              script.setAttribute('crossorigin', 'anonymous')
              script.setAttribute('loading', 'lazy')
              script.setAttribute('data-theme', window.KeepCommentPlugin.getGiscusTheme())
              document.querySelector('.giscus-comments-container').appendChild(script)
              script.onerror = () => {
                window.KeepCommentPlugin.loadFailHandle()
              }
              script.onload = () => {
                window.KeepCommentPlugin.hideLoading()
              }
              const toggleThemeBtn = document.querySelector('.tool-toggle-theme-mode')
              toggleThemeBtn && toggleThemeBtn.addEventListener('click', () => {
                window.KeepCommentPlugin.changeGiscusTheme()
              })
            }
          }

          if ('false' === "true") {
            setTimeout(() => {
              window.KeepCommentPlugin.initGiscus()
            }, 1000)
          } else {
            window.addEventListener("DOMContentLoaded", window.KeepCommentPlugin.initGiscus)
          }
        </script>
    </div>


        
    </div>





                
            </div>
        </div>

        
            <div class="pc-post-toc left-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x1-%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="nav-text">0x1 同一个类中的静态方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x2-%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="nav-text">0x2 主动调用同一个类中的静态方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x3%E5%90%8C%E4%B8%80%E4%B8%AA%E5%8C%85%E4%B8%8B%E7%9A%84%E4%B8%8D%E5%90%8C%E7%B1%BB"><span class="nav-text">0x3同一个包下的不同类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x4-%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text">0x4 实例化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x5-%E6%9C%89%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text">0x5 有上下文的实例化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x1%E7%9A%84%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-text">看起来可以模仿0x1的方法二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x2"><span class="nav-text">看起来可以模仿0x2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x4"><span class="nav-text">看起来可以模仿0x4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x6-%E5%AE%9E%E4%BE%8B%E5%AD%97%E6%AE%B5"><span class="nav-text">0x6 实例字段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x3"><span class="nav-text">看起来可以模仿0x3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x7-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-Constructor"><span class="nav-text">0x7 构造函数(Constructor)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x8-%E9%9D%99%E6%80%81so"><span class="nav-text">0x8 静态so</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x9-%E4%BF%AE%E6%94%B9%E9%9D%99%E6%80%81so%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-text">0x9 修改静态so返回值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xA-%E5%8A%A8%E6%80%81so"><span class="nav-text">0xA 动态so</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xB-%E5%8A%A0%E8%8A%B1%E7%9A%84so"><span class="nav-text">0xB 加花的so</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%86%85%E5%AD%98%E6%9D%83%E9%99%90"><span class="nav-text">修改内存权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E5%AF%B9%E9%BD%90"><span class="nav-text">字节对齐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">arch3rn4r</a>
        
    </div>

    <div class="theme-info info-item">
        由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    
        <div class="count-info info-item">
            
                <span class="count-item border-box word">
                    <span class="item-type border-box">总字数</span>
                    <span class="item-value border-box word">78k</span>
                </span>
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">访客数</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools left-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x1-%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="nav-text">0x1 同一个类中的静态方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x2-%E4%B8%BB%E5%8A%A8%E8%B0%83%E7%94%A8%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="nav-text">0x2 主动调用同一个类中的静态方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x3%E5%90%8C%E4%B8%80%E4%B8%AA%E5%8C%85%E4%B8%8B%E7%9A%84%E4%B8%8D%E5%90%8C%E7%B1%BB"><span class="nav-text">0x3同一个包下的不同类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x4-%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text">0x4 实例化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x5-%E6%9C%89%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="nav-text">0x5 有上下文的实例化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x1%E7%9A%84%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="nav-text">看起来可以模仿0x1的方法二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x2"><span class="nav-text">看起来可以模仿0x2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x4"><span class="nav-text">看起来可以模仿0x4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x6-%E5%AE%9E%E4%BE%8B%E5%AD%97%E6%AE%B5"><span class="nav-text">0x6 实例字段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%8B%E8%B5%B7%E6%9D%A5%E5%8F%AF%E4%BB%A5%E6%A8%A1%E4%BB%BF0x3"><span class="nav-text">看起来可以模仿0x3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x7-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-Constructor"><span class="nav-text">0x7 构造函数(Constructor)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x8-%E9%9D%99%E6%80%81so"><span class="nav-text">0x8 静态so</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x9-%E4%BF%AE%E6%94%B9%E9%9D%99%E6%80%81so%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-text">0x9 修改静态so返回值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xA-%E5%8A%A8%E6%80%81so"><span class="nav-text">0xA 动态so</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0xB-%E5%8A%A0%E8%8A%B1%E7%9A%84so"><span class="nav-text">0xB 加花的so</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%86%85%E5%AD%98%E6%9D%83%E9%99%90"><span class="nav-text">修改内存权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E5%AF%B9%E9%BD%90"><span class="nav-text">字节对齐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/header-shrink.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/back2top.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/toggle-theme.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/code-block.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/main.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/local-search.min.js"></script>


<!-- lazyload -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/lazyload.min.js"></script>


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/post-helper.min.js"></script>

        <!-- toc -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/toc.min.js"></script>
        

        <!-- copyright-info -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/copyright-info.min.js"></script>
        

        <!-- share -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/share.min.js"></script>
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



    
        
    

</body>
</html>
