<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="arch3rn4r">
    
    <title>
        
            python逆向 |
        
        arch3rn4r
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/solid.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/font/css/brands.min.css">
    
        
            
        
            
                
<link rel="stylesheet" href="/css/custom.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"arch3rn4r.github.io","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"arch3rn4r","author":"arch3rn4r","avatar":"/images/beauty/myhead.svg"},"menu":{"home":"/                        || fa-solid fa-home","archives":"/archives            || fa-solid fa-box-archive","tags":"/tags                    || fa-solid fa-tags","about":"/about                || fa-solid fa-user-graduate"},"first_screen":{"enable":true,"background_img":"/images/beauty/bg.jpg","background_img_dark":"https://arch3rn4r.github.io/picx-images-hosting/20240915/EYnModKVcAAy6sw.4g4g8oqoi0.webp","description":"这里是雨季，你那里阳光明媚吗","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":true,"hide_header":true},"home":{"announcement":null,"category":false,"tag":true,"post_datetime":"updated"},"post":{"author_badge":{"enable":false,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":true,"min2read":"ture"},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":true,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default","code_block_shrink":false},"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true,"layout":"left"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":true,"use":"giscus","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":"arch3rn4r/arch3rn4r.github.io","repo_id":"R_kgDOLnMFhw","category":"Announcements","category_id":"DIC_kwDOLnMFh84Cik-D","reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":true},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":true,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":true,"css":[null,"/css/custom.css"],"js":[null]},"root":"","source_data":{},"version":"4.2.3"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="arch3rn4r" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
            <a class="site-name border-box" href="/">
               arch3rn4r
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                首页
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                归档
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                标签
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/about">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-user-graduate"></i>
                                
                                关于
                                
                            </a>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            首页
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            归档
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            标签
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/about">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-user-graduate"></i>
                                </span>
                            
                            关于
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        python逆向
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/beauty/myhead.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">arch3rn4r</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-09-18 21:23:23</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Fri May 02 2025 10:41:59 GMT+0800">2025-05-02 10:41:59</span>
            </span>
        

        

        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>4k 字</span>
            </span>
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <p>参照此文章编写<a class="link"   target="_blank" rel="noopener" href="https://rocky.github.io/blackhat-asia-2024-additional/all-notes-print" >https://rocky.github.io/blackhat-asia-2024-additional/all-notes-print<i class="fas fa-external-link-alt"></i></a></p>
<p>Python 字节码的变化非常大，每个版本之间都有很大的区别。高级字节码的一个方面：许多源信息（如变量名称及其类型）都保存在字节码中。所以反编译回来的程序会和源代码非常像（简直一模一样）。但是来自源文本的注释不会显示在重建结果中，这是因为这些注释不会出现在字节码中的任何位置。</p>
<p>The disassembler is great with code that doesn’t have jumps in it. But once we have jumps, like we have in the highlighted instructions, a disassembler has to stop combining instructions.</p>
<p>反汇编器非常适合没有跳转的代码。但是，一旦我们有了跳转，就像我们在突出显示的指令中一样，反汇编器必须停止组合指令。</p>
<p>With each new Python release, control flow decompilation has become increasingly more difficult. Nowadays, about 1&#x2F;3 of the issues raised in the decompiler bug trackers are related to control flow.</p>
<p>随着每个新的 Python 版本的发布，控制流反编译变得越来越困难。如今，反编译器错误跟踪器中提出的问题中约有 1&#x2F;3 与控制流有关。</p>
<p>Grammars and the grammar-based approach we use, however, can naturally parse nesting and sequencing control structures quite well. So having a methodical way to characterize control flow that fits into the decompiler parsing can give more precision and accuracy that is not available in general-purpose decompilers</p>
<p>然而，语法和我们使用的基于语法的方法可以很自然地很好地解析嵌套和排序控制结构。因此，有一种有条不紊的方法来表征适合反编译器解析的控制流，可以提供通用反编译器所不具备的更高的精度和准确性</p>
<p>There are other decompilers for Python. They all start out with a disassembly, even the one I looked at that uses machine learning. Many build a tree—more or less—based on instructions from a disasssembly, and they all produce source text from that internal tree-ish structure.</p>
<p>Python 还有其他反编译器。它们都是从拆解开始的，即使是我看到的那个使用机器学习的拆解。许多人或多或少地根据反汇编的指令构建了一棵树，并且它们都从内部的树状结构中生成源文本。</p>
<p>However, they are a bit more ad hoc. None use the grammar-based approach here. The phases are fewer and a little less distinct.</p>
<p>但是，它们更具临时性。这里没有使用基于语法的方法。相位较少，也不太明显。</p>
<p>General-purpose decompilers like you find in Ghidra are largely different. They live in a more complicated world. To be able to do things across a wider spectrum of machine languages and a wider spectrum of programming-language environments, they largely give up on the hope of noticing specific patterns of instructions. This came up in the chained-comparison example. The ability to match specific patterns is what makes these decompilers produce extremely intuitive and accurate results and written in the programming language that the source text was also written in.</p>
<p>像你在 Ghidra 中发现的通用反编译器有很大不同。他们生活在一个更加复杂的世界里。为了能够在更广泛的机器语言和更广泛的编程语言环境中做事，他们在很大程度上放弃了注意到特定指令模式的希望。这出现在链式比较示例中。匹配特定模式的能力使这些反编译器能够产生极其直观和准确的结果，并且是用编写源文本的编程语言编写的。</p>
<p>Control Flow, in General-purpose decompilers, is its own canned phase. This phase doesn’t take into account the specific target programming language that produced the code and the specific set of control-flow structures that the source language has.</p>
<p>在通用反编译器中，控制流是它自己的固定阶段。此阶段不考虑生成代码的特定目标编程语言以及源语言具有的特定控制流结构集。</p>
<p>Our control flow is intimately tied to the control flow for a particular Python version. When Python added a new construct like “async” co-routines in Python 3.5, it added a new kind of control-flow pattern match. Python has an extremely rich set of control-flow structures. I know of no canned control-flow-detection mechanism that would be able to cover all control-flow mechanisms that Python includes like the “else” clauses on “while”, “for”, and “try” blocks.</p>
<p>我们的控制流与特定 Python 版本的控制流密切相关。当 Python 在 Python 3.5 中添加类似“异步”协程的新构造时，它添加了一种新的控制流模式匹配。Python 具有一组极其丰富的控制流结构。据我所知，没有一种预制的控制流检测机制能够涵盖 Python 包含的所有控制流机制，例如“while”、“for”和“try”块上的“else”子句。</p>
<p>Our approach uses tokenization to facilitated parsing. This is similar to the lift phase that general-purpose decompilers often do after initial disassembly . In general-purpose decompilers, the lifting language is sometimes to LLVM or an LLVM-like language. In Python, our intermediate language is very much tied to Python bytecode. In general, that is true for all high-level bytecode decompilers. The intermediate code looks like the high-level bytecode. Also, this intermediate language drifts over time along with the language and bytecode drift.</p>
<p>我们的方法使用标记化来促进解析。这类似于通用反编译器在初始反汇编后经常执行的提升阶段。在通用反编译器中，提升语言有时是 LLVM 或类似 LLVM 的语言。在 Python 中，我们的中间语言与 Python 字节码密切相关。通常，所有高级字节码反编译器都是如此。中间代码类似于高级字节码。此外，这种中间语言会随着语言和字节码的漂移而漂移。</p>
<p>作者给出了实验性的新代码，Chained Compare Parse Tree 链式比较解析树</p>
<h2 id="python开发"><a href="#python开发" class="headerlink" title="python开发"></a>python开发</h2><p>python打包成exe的方法<a class="link"   target="_blank" rel="noopener" href="https://saucer-man.com/information_security/825.html" >https://saucer-man.com/information_security/825.html<i class="fas fa-external-link-alt"></i></a></p>
<p>编写了个小代码来进行下面的逆向</p>
<p>pyinstaller -F -w -n active exercise.py</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span>F 或 <span class="comment">--onefile：这个选项告诉 PyInstaller 将所有文件打包进一个单独的可执行文件中。这样做的好处是分发和运行应用程序更为简单，因为所有依赖项都包含在这个单一文件中。</span></span><br><span class="line"><span class="operator">-</span>w 或 <span class="comment">--windowed：这个选项用于指定应用程序应该在没有控制台窗口的情况下运行。这对于图形用户界面（GUI）应用程序特别有用，因为它可以让应用程序在运行时不会显示命令行窗口。</span></span><br><span class="line"><span class="operator">-</span>n 或 <span class="comment">--name：这个选项允许你指定打包后可执行文件的名称。在这个例子中，可执行文件的名称将是 active。</span></span><br></pre></td></tr></table></figure>

<p><img  
                       lazyload
                       alt="image"
                       data-src="https://arch3rn4r.github.io/picx-images-hosting/20240918/1280X1280-(1).45hmk0kgkd.webp"
                       
                 ></p>
<p>(太容易报毒了建议暂时关掉防护，把我刚生成的exe文件删掉了）</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="https://arch3rn4r.github.io/picx-images-hosting/20240918/c58752b4-390b-4df2-a0a4-0100ade21a53.pfarxb471.webp"
                       
                 ></p>
<h2 id="解包exe"><a href="#解包exe" class="headerlink" title="解包exe"></a>解包exe</h2><p><strong>Pyinstxtractor</strong></p>
<p>Pyinstxtractor可以解包exe</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://sourceforge.net/projects/pyinstallerextractor/</span><br><span class="line">python pyinstxtractor.py  待解包的文件名.exe</span><br></pre></td></tr></table></figure>

<p>执行后就像这样</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="https://arch3rn4r.github.io/picx-images-hosting/20240918/27949373-07cb-4d55-bf34-2e9341c35f37.5mnrlrpgag.webp"
                       
                 ></p>
<p>一般来说我们会获得一个和我们解包的exe同名的pyc文件，这个时候就和第一种类型题目一样，将pyc文件还原成py文件进行逆向即可。</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="https://arch3rn4r.github.io/picx-images-hosting/20240918/400e1220-c29e-444a-9973-1cf9f69273f8.1e8kbxzbw6.webp"
                       
                 ></p>
<h3 id="解包文件后文件组成"><a href="#解包文件后文件组成" class="headerlink" title="解包文件后文件组成"></a>解包文件后文件组成</h3><p><code>PYZ-00.pyz_extracted</code>非常重要，一般一个稍微大一点的项目都会分成多个<code>py</code>文件，甚至会依赖其他模块，这些被依赖的文件解析后都会放入<code>PYZ-00.pyz_extracted</code>中，可以说这里放的是核心代码。</p>
<h2 id="pyc逆向"><a href="#pyc逆向" class="headerlink" title="pyc逆向"></a>pyc逆向</h2><h3 id="pyc结构"><a href="#pyc结构" class="headerlink" title="pyc结构"></a>pyc结构</h3><p>pyc文件分为<strong>pyc文件头部分</strong>和<strong>PyCodeObject部分。</strong>文件头部分即为上文中谈到的魔数时间戳部分，而PyCodeObject是在CPython（Python 的官方解释器实现）中用来表示编译后的代码对象的结构体。实际上，pyc 文件就是 PyCodeObject 对象在硬盘上的保存形式。</p>
<p>不同版本的python的魔数头</p>
<p><strong>PyObject_HEAD</strong></p>
<p>不同的 Python 版本会有不同的 PyObject_HEAD：</p>
<style> td {white-space:nowrap;border:1px solid #dee0e3;font-size:10pt;font-style:normal;font-weight:normal;vertical-align:middle;word-break:normal;word-wrap:normal;}</style>

<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Python 版本</td>
<td>十六进制文件头</td>
</tr>
<tr>
<td>Python 2.7</td>
<td>03f30d0a00000000</td>
</tr>
<tr>
<td>Python 3.0</td>
<td>3b0c0d0a00000000</td>
</tr>
<tr>
<td>Python 3.1</td>
<td>4f0c0d0a00000000</td>
</tr>
<tr>
<td>Python 3.2</td>
<td>6c0c0d0a00000000</td>
</tr>
<tr>
<td>Python 3.3</td>
<td>9e0c0d0a0000000000000000</td>
</tr>
<tr>
<td>Python 3.4</td>
<td>ee0c0d0a0000000000000000</td>
</tr>
<tr>
<td>Python 3.5</td>
<td>170d0d0a0000000000000000</td>
</tr>
<tr>
<td>Python 3.6</td>
<td>330d0d0a0000000000000000</td>
</tr>
<tr>
<td>Python 3.7</td>
<td>420d0d0a000000000000000000000000</td>
</tr>
<tr>
<td>Python 3.8</td>
<td>55 0d 0d 0a 00 00 00 00 00 00 00 00 00 00 00 00</td>
</tr>
<tr>
<td>Python 3.9</td>
<td>610d0d0a000000000000000000000000</td>
</tr>
<tr>
<td>Python 3.10</td>
<td>6f0d0d0a000000000000000000000000</td>
</tr>
<tr>
<td>Python 3.11</td>
<td>a70d0d0a000000000000000000000000</td>
</tr>
</tbody></table>
<p><strong>PyCodeObject 的结构如下：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">PyObject_HEADint co_argcount;        /* 位置参数个数 */</span><br><span class="line"><span class="built_in">int</span> co_nlocals;         /* 局部变量个数 */</span><br><span class="line"><span class="built_in">int</span> co_stacksize;       /* 栈大小 */</span><br><span class="line"><span class="built_in">int</span> co_flags;PyObjectco_code;      /字节码指令序列 */</span><br><span class="line">PyObjectco_consts;    /所有常量集合 */</span><br><span class="line">PyObjectco_names;     /所有符号名称集合 */</span><br><span class="line">PyObjectco_varnames;  /局部变量名称集合 */</span><br><span class="line">PyObjectco_freevars;  /闭包用的的变量名集合 */</span><br><span class="line">PyObjectco_cellvars;  /内部嵌套函数引用的变量名集合 */</span><br><span class="line">/* The rest doesn’t count <span class="keyword">for</span> <span class="built_in">hash</span>/cmp */PyObjectco_filename;  /代码所在文件名 */</span><br><span class="line">PyObjectco_name;      /模块名|函数名|类名 */</span><br><span class="line"><span class="built_in">int</span> co_firstlineno;     /* 代码块在文件中的起始行号 */</span><br><span class="line">PyObjectco_lnotab;    /字节码指令和行号的对应关系 */</span><br><span class="line">voidco_zombieframe;   /<span class="keyword">for</span> optimization only (see frameobject.c) */</span><br><span class="line">&#125; PyCodeObject;</span><br></pre></td></tr></table></figure>

<h3 id="代码-pyc字节码"><a href="#代码-pyc字节码" class="headerlink" title="代码-&gt;pyc字节码"></a>代码-&gt;<strong>pyc字节码</strong></h3><p>字节码文件的扩展名通常以“.pyc”结尾，或“.pyo”</p>
<h4 id="1-compileall"><a href="#1-compileall" class="headerlink" title="1.compileall"></a>1.compileall</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m compileall test.py</span><br></pre></td></tr></table></figure>

<p>成功编译后会当前目录生成相应文件夹和文件</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">V PYTHONEX</span><br><span class="line">    v <span class="built_in">_</span>pycache</span><br><span class="line">        exercise.cpython-38.pyc</span><br></pre></td></tr></table></figure>

<p>现在我用的是3.8.18，所以用decompyle3和uncompyle6分别试试反编译</p>
<p>结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PS D: anquan_reandpwn \pythonex\pyctest&gt; decompyle3 exercise. cpython-38.pyc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">decompyle3 version 3.9.1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Python bytecode version base 3.8.0 (3413)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Decompiled from: Python 3.8.18 (default, Sep 11 2023, 13:39:12) [MSC v.1916 64 bit (AMD64)]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Embedded file name: exercise.py</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Compiled at: 2024-07-22 21:25:42</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Size of <span class="built_in">source</span> mod 2 ** 32: 80 bytes</span></span><br><span class="line"></span><br><span class="line">def hello():</span><br><span class="line">    print(&quot;hello,hacker&quot;)</span><br><span class="line"></span><br><span class="line">if __main__ == &quot;__main__&quot;</span><br><span class="line">    hello()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">okay decompiling exercise.cpython-38.pyc</span></span><br><span class="line">PS D:\anquan_reandpwn\pythonex\pyctest&gt;</span><br></pre></td></tr></table></figure>

<p>对于这些参数的解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">以 # 开头是注释。顶部的部分包含一些元数据，这些元数据存储在字节码文件中。它不是我们之前在十六进制中看到的 25 字节指令序列的一部分(不是代码执行的一部分）</span><br><span class="line"></span><br><span class="line">Each bytecode has a unique number for the bytecode variant. Here, it is 3413, and this variant covers Python version 3.8.</span><br><span class="line">每个字节码都有一个字节码变体的唯一编号。这里是 3413，这个变体涵盖了 Python 3.8 版。</span><br><span class="line"></span><br><span class="line">Major releases of Python typically can alter the programming language and/or the bytecode, and/or the way the source text gets translated.</span><br><span class="line">Python 的主要版本通常可以更改编程语言和/或字节码，和/或源文本的翻译方式。</span><br><span class="line"></span><br><span class="line">反编译的文件名</span><br><span class="line"></span><br><span class="line">代码编写时间</span><br></pre></td></tr></table></figure>

<p>我没下载相对应的uncomply6版本，就不演示了</p>
<h4 id="2-dis库（disassember-）："><a href="#2-dis库（disassember-）：" class="headerlink" title="2.dis库（disassember ）："></a>2.dis库（disassember ）：</h4><p>There is a disassember in the standard Python Library called <em>dis</em>. Most novice decompilers use this— it’s the first thing that comes to mind. But that has some serious limitations. The biggest limitation is that it can only disassemble code for a single Python version, the version that is runining the decompiler. If you are running the latest version of Python, such 3.12, but the bytecode you want to analyze is from an earlier version, like bytecode from 2.7, then you are out of luck. Malware written in Python tends to use older versions of Python. This was the situation when Microsoft folks contacted me.<br>在标准 Python 库中有一个名为 disassember 的dis。大多数新手反编译器都使用它——这是首先想到的。但这有一些严重的局限性。最大的限制是它只能反汇编单个 Python 版本的代码，即运行反编译器的版本。如果您运行的是最新版本的 Python，例如 3.12，但要分析的字节码来自早期版本，例如 2.7 的字节码，那么您就不走运了。用 Python 编写的恶意软件倾向于使用旧版本的 Python。当Microsoft的人联系我时，情况就是这样</p>
<p>显示字节码的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line">dis.dis(you_function)</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">python -m dis xxx.py</span><br></pre></td></tr></table></figure>



<h3 id="pyc字节码-代码"><a href="#pyc字节码-代码" class="headerlink" title="pyc字节码-&gt;代码"></a>pyc字节码-&gt;代码</h3><h4 id="uncompyle6的详细介绍"><a href="#uncompyle6的详细介绍" class="headerlink" title="uncompyle6的详细介绍"></a><strong>uncompyle6的详细介绍</strong></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install uncompyle6</span><br><span class="line">uncompyle6 -o output_file.py your_file.pyc-o </span><br><span class="line">目标生成的Python文件名 原pyc文件名</span><br></pre></td></tr></table></figure>

<p>uncompyle6的工作原理:</p>
<ol>
<li><p>Get bytecode disassembly using <em><a class="link"   target="_blank" rel="noopener" href="https://pypi.org/project/xdis" >xdis<i class="fas fa-external-link-alt"></i></a></em>. <em>xdis</em> is the cross-version disassembly library that I wrote to be able to support these decompilers. It is also useful in other projects that work with Python bytecode.<br>使用 xdis 获取字节码反汇编。xdis 是我（uncompyle6作者，这段文字复制于原文）编写的跨版本反汇编库，以便能够支持这些反编译器。它在使用 Python 字节码的其他项目中也很有用。</p>
</li>
<li><p>“ Tokenize” the disassembly. “Tokenize” is a compiler-centric term. In other decompilers and code-analysis tools, this process is sometimes called <em>lifting</em>, as in “lifting the disassembly” or “lifting the machine code”.<br>“标记化”反汇编。“Tokenize”是一个以编译器为中心的术语。在其他反编译器和代码分析工具中，此过程有时称为提升，如“提升反汇编”或“提升机器代码”。</p>
</li>
<li><p>Parse tokens to create a Parse Tree.<br>解析令牌以创建解析树。</p>
</li>
<li><p>Abstract the parse tree to an “Abstract Syntax Tree”, and finally:<br>将解析树抽象为“抽象语法树”，最后：</p>
</li>
<li><p>Produce Python source text from the Abstract Syntax Tree.<br>从抽象语法树生成 Python 源文本。</p>
</li>
</ol>
<p>在机器代码中，操作数通常是寄存器值，可以是数字、地址或地址的一部分。在 Python 字节码中，操作数是任意的 Python 对象！</p>
<h5 id="xdis"><a href="#xdis" class="headerlink" title="xdis"></a>xdis</h5><p><a class="link"   target="_blank" rel="noopener" href="https://pypi.org/project/xdis/" >https://pypi.org/project/xdis/<i class="fas fa-external-link-alt"></i></a></p>
<p>uncompyle6 和 decompile3 使用 xdis——“跨 Python 反汇编器”。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pip install xdis</span><br><span class="line">pydisasm -F extended-<span class="built_in">bytes</span> -S test.pyc</span><br><span class="line"></span><br><span class="line">-F extended-<span class="built_in">bytes</span>：指定输出格式为扩展字节码</span><br><span class="line">-S：显示源代码和对应的字节码</span><br><span class="line"> -F, --<span class="built_in">format</span> [xasm|<span class="built_in">bytes</span>|classic|dis|extended|extended-<span class="built_in">bytes</span>|header]</span><br><span class="line">                                  Select disassembly style</span><br><span class="line"> -S, --show-source / --no-show-source</span><br><span class="line">                                  Intersperse Python source text <span class="keyword">from</span> linecache <span class="keyword">if</span> available.</span><br><span class="line"> --version                       Show the version <span class="keyword">and</span> exit.</span><br><span class="line"> --<span class="built_in">help</span>                          Show this message <span class="keyword">and</span> exit.</span><br></pre></td></tr></table></figure>

<p>结果如下（如果你看了前面的文章链接，就会发现我这里生成的数据和作者的不一样，也许是版本原因，我使用的是python3.8.18,xdis使用的是6.1.1）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">$pydisasm -F extended-<span class="built_in">bytes</span> -S exercise.cpython-<span class="number">38.</span>pyc  </span><br><span class="line"></span><br><span class="line"><span class="comment"># pydisasm version 6.1.1</span></span><br><span class="line"><span class="comment"># Python bytecode 3.8.0 (3413)</span></span><br><span class="line"><span class="comment"># Disassembled from Python 3.8.18 (default, Sep 11 2023, 13:39:12) [MSC v.1916 64 bit (AMD64)]</span></span><br><span class="line"><span class="comment"># Timestamp in code: 1721654742 (2024-07-22 21:25:42)</span></span><br><span class="line"><span class="comment"># Source code size mod 2**32: 80 bytes</span></span><br><span class="line"><span class="comment"># Method Name:       &lt;module&gt;</span></span><br><span class="line"><span class="comment"># Filename:          exercise.py</span></span><br><span class="line"><span class="comment"># Argument count:    0</span></span><br><span class="line"><span class="comment"># Position-only argument count: 0</span></span><br><span class="line"><span class="comment"># Keyword-only arguments: 0</span></span><br><span class="line"><span class="comment"># Number of locals:  0</span></span><br><span class="line"><span class="comment"># Stack size:        2</span></span><br><span class="line"><span class="comment"># Flags:             0x00000040 (NOFREE)</span></span><br><span class="line"><span class="comment"># First Line:        1</span></span><br><span class="line"><span class="comment"># Constants:</span></span><br><span class="line"><span class="comment">#    0: &lt;code object hello at 0x00000201695ABD40, file &quot;exercise.py&quot;, line 1&gt;</span></span><br><span class="line"><span class="comment">#    1: &#x27;hello&#x27;</span></span><br><span class="line"><span class="comment">#    2: &#x27;__main__&#x27;</span></span><br><span class="line"><span class="comment">#    3: None</span></span><br><span class="line"><span class="comment"># Names:</span></span><br><span class="line"><span class="comment">#    0: hello</span></span><br><span class="line"><span class="comment">#    1: __name__</span></span><br><span class="line">  <span class="number">1</span>:           <span class="number">0</span> |<span class="number">64</span> <span class="number">00</span>| LOAD_CONST           (&lt;code <span class="built_in">object</span> hello at <span class="number">0x00000201695ABD40</span>, file <span class="string">&quot;exercise.py&quot;</span>, line <span class="number">1</span>&gt;) ; TOS = &lt;code <span class="built_in">object</span> hello at <span class="number">0x00000201695ABD40</span>, file <span class="string">&quot;exercise.py&quot;</span>, line <span class="number">1</span>&gt;</span><br><span class="line">               <span class="number">2</span> |<span class="number">64</span> 01| LOAD_CONST           (<span class="string">&quot;hello&quot;</span>) ; TOS = <span class="string">&quot;hello&quot;</span></span><br><span class="line">               <span class="number">4</span> |<span class="number">84</span> <span class="number">00</span>| MAKE_FUNCTION        (No arguments) ; TOS = <span class="keyword">def</span> <span class="title function_">hello</span>(): ...</span><br><span class="line">               <span class="number">6</span> |5a <span class="number">00</span>| STORE_NAME           (hello) ; hello = <span class="keyword">def</span> <span class="title function_">hello</span>(): ...</span><br><span class="line"></span><br><span class="line">  <span class="number">4</span>:           <span class="number">8</span> |<span class="number">65</span> 01| LOAD_NAME            (__name__) ; TOS = __name__</span><br><span class="line">              <span class="number">10</span> |<span class="number">64</span> 02| LOAD_CONST           (<span class="string">&quot;__main__&quot;</span>) ; TOS = <span class="string">&quot;__main__&quot;</span></span><br><span class="line">              <span class="number">12</span> |6b 02| COMPARE_OP           (==) ; TOS = __name__ == (<span class="string">&quot;__main__&quot;</span>)</span><br><span class="line">              <span class="number">14</span> |<span class="number">72</span> <span class="number">16</span>| POP_JUMP_IF_FALSE    (to <span class="number">22</span>)</span><br><span class="line"></span><br><span class="line">  <span class="number">5</span>:          <span class="number">16</span> |<span class="number">65</span> <span class="number">00</span>| LOAD_NAME            (hello) ; TOS = hello</span><br><span class="line">              <span class="number">18</span> |<span class="number">83</span> <span class="number">00</span>| CALL_FUNCTION        (<span class="number">0</span> positional arguments) ; TOS = hello()</span><br><span class="line">              <span class="number">20</span> |01 <span class="number">00</span>| POP_TOP</span><br><span class="line">         &gt;&gt;   <span class="number">22</span> |<span class="number">64</span> 03| LOAD_CONST           (<span class="literal">None</span>) ; TOS = <span class="literal">None</span></span><br><span class="line">              <span class="number">24</span> |<span class="number">53</span> <span class="number">00</span>| RETURN_VALUE         <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Method Name:       hello</span></span><br><span class="line"><span class="comment"># Filename:          exercise.py</span></span><br><span class="line"><span class="comment"># Argument count:    0</span></span><br><span class="line"><span class="comment"># Position-only argument count: 0</span></span><br><span class="line"><span class="comment"># Keyword-only arguments: 0</span></span><br><span class="line"><span class="comment"># Number of locals:  0</span></span><br><span class="line"><span class="comment"># Stack size:        2</span></span><br><span class="line"><span class="comment"># Flags:             0x00000043 (NOFREE | NEWLOCALS | OPTIMIZED)</span></span><br><span class="line"><span class="comment"># First Line:        1</span></span><br><span class="line"><span class="comment"># Constants:</span></span><br><span class="line"><span class="comment">#    0: None</span></span><br><span class="line"><span class="comment">#    1: &#x27;hello,hacker&#x27;</span></span><br><span class="line"><span class="comment"># Names:</span></span><br><span class="line"><span class="comment">#    0: print</span></span><br><span class="line">  <span class="number">2</span>:           <span class="number">0</span> |<span class="number">74</span> <span class="number">00</span>| LOAD_GLOBAL          (<span class="built_in">print</span>) ; TOS = <span class="built_in">print</span></span><br><span class="line">               <span class="number">2</span> |<span class="number">64</span> 01| LOAD_CONST           (<span class="string">&quot;hello,hacker&quot;</span>) ; TOS = <span class="string">&quot;hello,hacker&quot;</span></span><br><span class="line">               <span class="number">4</span> |<span class="number">83</span> 01| CALL_FUNCTION        (<span class="number">1</span> positional argument) ; TOS = <span class="built_in">print</span>(<span class="string">&quot;hello,hacker&quot;</span>)</span><br><span class="line">               <span class="number">6</span> |01 <span class="number">00</span>| POP_TOP</span><br><span class="line">               <span class="number">8</span> |<span class="number">64</span> <span class="number">00</span>| LOAD_CONST           (<span class="literal">None</span>) ; TOS = <span class="literal">None</span></span><br><span class="line">              <span class="number">10</span> |<span class="number">53</span> <span class="number">00</span>| RETURN_VALUE         <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="pycdc"><a href="#pycdc" class="headerlink" title="pycdc"></a><strong>pycdc</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/extremecoders-re/decompyle-builds</span><br><span class="line">pycdc -o output_file.py your_file.pyc</span><br></pre></td></tr></table></figure>

<h4 id="decompyle3"><a href="#decompyle3" class="headerlink" title="decompyle3"></a><strong>decompyle3</strong></h4><p>它只处理 Python 3.7 和 3.8。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install decompyle3</span><br><span class="line"> decompyle3 *compiled-python-file-pyc-<span class="keyword">or</span>-pyo*</span><br></pre></td></tr></table></figure>

<h2 id="加花的pyc"><a href="#加花的pyc" class="headerlink" title="加花的pyc"></a>加花的pyc</h2><h2 id="Python-字节码控制流分析"><a href="#Python-字节码控制流分析" class="headerlink" title="Python 字节码控制流分析"></a>Python 字节码控制流分析</h2><p>Python control_flow</p>
<h2 id="python序列化和反序列化"><a href="#python序列化和反序列化" class="headerlink" title="python序列化和反序列化"></a>python序列化和反序列化</h2><h3 id="marshal-读写pyc字节码"><a href="#marshal-读写pyc字节码" class="headerlink" title="marshal(读写pyc字节码):"></a>marshal(读写pyc字节码):</h3><p><code>marshal</code> 模块是 Python 内置的一个模块，用于在二进制格式和 Python 对象之间进行序列化和反序列化。与 <code>pickle</code> 模块不同，<code>marshal</code> 模块主要用于处理 Python 字节码，并且不保证跨 Python 版本的兼容性。通常，<code>marshal</code> 用于读写 <code>.pyc</code> 文件中的字节码。</p>
<p><code>marshal</code> 模块的常用函数</p>
<ol>
<li><p>**<code>marshal.dump</code>**：将 Python 对象序列化到文件中。</p>
</li>
<li><p>**<code>marshal.load</code>**：从文件中反序列化 Python 对象。</p>
</li>
<li><p>**<code>marshal.dumps</code>**：将 Python 对象序列化为二进制数据。</p>
</li>
<li><p>**<code>marshal.loads</code>**：将二进制数据反序列化为 Python 对象</p>
</li>
</ol>
<p>利用示范</p>
<p>对象和文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将对象序列化到文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.marshal&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    marshal.dump(data, f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件反序列化对象</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.marshal&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = marshal.load(f)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)  <span class="comment"># 输出: &#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2, &#x27;c&#x27;: 3&#125;</span></span><br></pre></td></tr></table></figure>

<p>对象和二进制数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将对象序列化为二进制数据</span></span><br><span class="line">binary_data = marshal.dumps(data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(binary_data)  <span class="comment"># 输出: 二进制数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#从二进制数据反序列化对象</span></span><br><span class="line">data=marshal.loads(binary_data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                python逆向
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2024/09/18/python逆向/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    作者
                </div>
                <div class="content">arch3rn4r</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    发布于
                </div>
                <div class="content">2024-09-18 21:23</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    许可
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="复制版权信息" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="分享到 QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="分享到微信"
            data-tooltip-img-tip="微信扫一扫"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="分享到微博"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2024/09/21/linux%E6%B2%99%E7%AE%B1%E4%B9%8B%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E9%9A%94%E7%A6%BB/"
                                   title="linux沙箱之文件系统隔离"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">linux沙箱之文件系统隔离</span>
                                        <span class="post-nav-item">上一篇</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2024/09/18/%E5%8A%A8%E6%80%81%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C/"
                                   title="动态符号执行"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">动态符号执行</span>
                                        <span class="post-nav-item">下一篇</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    


    <div class="comments-container border-box">
        <div id="comments-anchor" class="comment-area-title border-box">
            <i class="fas fa-comments"></i>&nbsp;评论
        </div>
        <div class="comment-plugin-fail border-box">
    <span class="fail-tip">评论插件加载失败</span>
    <button class="reload keep-button">点击重新加载</button>
</div>
<div class="comment-plugin-loading flex-center border-box">
    <i class="loading-icon fa-solid fa-spinner fa-spin"></i>
    <span class="load-tip">正在加载评论插件</span>
</div>
<script data-pjax>
  window.KeepCommentPlugin = {}
  window.KeepCommentPlugin.hideLoading = () => {
    const cplDom = document.querySelector('.comments-container .comment-plugin-loading')
    cplDom.style.display = 'none'
  }
  window.KeepCommentPlugin.loadFailHandle = () => {
    window.KeepCommentPlugin.hideLoading()
    const cpfDom = document.querySelector('.comments-container .comment-plugin-fail')
    cpfDom.style.display = 'flex'
    cpfDom.querySelector('.reload').addEventListener('click', () => {
      window.location.reload()
    })
  }
</script>

        
            

    <div class="giscus-comments-container">
        <div class="giscus" id="giscus"></div>
        <script 
                onerror="window.KeepCommentPlugin.loadFailHandle()"
        >
          if (!window.KeepCommentPlugin?.getGiscusTheme) {
            window.KeepCommentPlugin.getGiscusTheme = () => {
              return document.documentElement.classList.contains('dark-mode') ? 'dark_dimmed' : 'light_tritanopia'
            }
          }

          if (!window.KeepCommentPlugin?.changeGiscusTheme) {
            window.KeepCommentPlugin.changeGiscusTheme = () => {
              const iframe = document.querySelector('iframe.giscus-frame')
              iframe && iframe.contentWindow.postMessage({
                giscus: {
                  setConfig: {
                    theme: window.KeepCommentPlugin.getGiscusTheme()
                  }
                }
              }, 'https://giscus.app')
            }
          }

          if (!window.KeepCommentPlugin?.initGiscus) {
            window.KeepCommentPlugin.initGiscus = () => {
              const script = document.createElement('script')
              script.async = true
              script.src = 'https://giscus.app/client.js'
              script.setAttribute('data-repo', 'arch3rn4r/arch3rn4r.github.io')
              script.setAttribute('data-repo-id', 'R_kgDOLnMFhw')
              script.setAttribute('data-category', 'Announcements')
              script.setAttribute('data-category-id', 'DIC_kwDOLnMFh84Cik-D')
              script.setAttribute('data-reactions-enabled', '0')
              script.setAttribute('data-lang', 'zh-CN')
              script.setAttribute('data-mapping', 'pathname')
              script.setAttribute('data-strict', '0')
              script.setAttribute('data-emit-metadata', '0')
              script.setAttribute('data-input-position', 'top')
              script.setAttribute('crossorigin', 'anonymous')
              script.setAttribute('loading', 'lazy')
              script.setAttribute('data-theme', window.KeepCommentPlugin.getGiscusTheme())
              document.querySelector('.giscus-comments-container').appendChild(script)
              script.onerror = () => {
                window.KeepCommentPlugin.loadFailHandle()
              }
              script.onload = () => {
                window.KeepCommentPlugin.hideLoading()
              }
              const toggleThemeBtn = document.querySelector('.tool-toggle-theme-mode')
              toggleThemeBtn && toggleThemeBtn.addEventListener('click', () => {
                window.KeepCommentPlugin.changeGiscusTheme()
              })
            }
          }

          if ('false' === "true") {
            setTimeout(() => {
              window.KeepCommentPlugin.initGiscus()
            }, 1000)
          } else {
            window.addEventListener("DOMContentLoaded", window.KeepCommentPlugin.initGiscus)
          }
        </script>
    </div>


        
    </div>





                
            </div>
        </div>

        
            <div class="pc-post-toc left-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E5%BC%80%E5%8F%91"><span class="nav-text">python开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%8C%85exe"><span class="nav-text">解包exe</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%8C%85%E6%96%87%E4%BB%B6%E5%90%8E%E6%96%87%E4%BB%B6%E7%BB%84%E6%88%90"><span class="nav-text">解包文件后文件组成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pyc%E9%80%86%E5%90%91"><span class="nav-text">pyc逆向</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pyc%E7%BB%93%E6%9E%84"><span class="nav-text">pyc结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-pyc%E5%AD%97%E8%8A%82%E7%A0%81"><span class="nav-text">代码-&gt;pyc字节码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-compileall"><span class="nav-text">1.compileall</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-dis%E5%BA%93%EF%BC%88disassember-%EF%BC%89%EF%BC%9A"><span class="nav-text">2.dis库（disassember ）：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pyc%E5%AD%97%E8%8A%82%E7%A0%81-%E4%BB%A3%E7%A0%81"><span class="nav-text">pyc字节码-&gt;代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#uncompyle6%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D"><span class="nav-text">uncompyle6的详细介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#xdis"><span class="nav-text">xdis</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pycdc"><span class="nav-text">pycdc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#decompyle3"><span class="nav-text">decompyle3</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%8A%B1%E7%9A%84pyc"><span class="nav-text">加花的pyc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-%E5%AD%97%E8%8A%82%E7%A0%81%E6%8E%A7%E5%88%B6%E6%B5%81%E5%88%86%E6%9E%90"><span class="nav-text">Python 字节码控制流分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">python序列化和反序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#marshal-%E8%AF%BB%E5%86%99pyc%E5%AD%97%E8%8A%82%E7%A0%81"><span class="nav-text">marshal(读写pyc字节码):</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">arch3rn4r</a>
        
    </div>

    <div class="theme-info info-item">
        由&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;驱动&nbsp;&&nbsp;主题&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    
        <div class="count-info info-item">
            
                <span class="count-item border-box word">
                    <span class="item-type border-box">总字数</span>
                    <span class="item-value border-box word">78.1k</span>
                </span>
            

            
                <span class="count-item border-box uv">
                    <span class="item-type border-box">访客数</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools left-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E5%BC%80%E5%8F%91"><span class="nav-text">python开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%8C%85exe"><span class="nav-text">解包exe</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%8C%85%E6%96%87%E4%BB%B6%E5%90%8E%E6%96%87%E4%BB%B6%E7%BB%84%E6%88%90"><span class="nav-text">解包文件后文件组成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pyc%E9%80%86%E5%90%91"><span class="nav-text">pyc逆向</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pyc%E7%BB%93%E6%9E%84"><span class="nav-text">pyc结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81-pyc%E5%AD%97%E8%8A%82%E7%A0%81"><span class="nav-text">代码-&gt;pyc字节码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-compileall"><span class="nav-text">1.compileall</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-dis%E5%BA%93%EF%BC%88disassember-%EF%BC%89%EF%BC%9A"><span class="nav-text">2.dis库（disassember ）：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pyc%E5%AD%97%E8%8A%82%E7%A0%81-%E4%BB%A3%E7%A0%81"><span class="nav-text">pyc字节码-&gt;代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#uncompyle6%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D"><span class="nav-text">uncompyle6的详细介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#xdis"><span class="nav-text">xdis</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pycdc"><span class="nav-text">pycdc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#decompyle3"><span class="nav-text">decompyle3</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%8A%B1%E7%9A%84pyc"><span class="nav-text">加花的pyc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Python-%E5%AD%97%E8%8A%82%E7%A0%81%E6%8E%A7%E5%88%B6%E6%B5%81%E5%88%86%E6%9E%90"><span class="nav-text">Python 字节码控制流分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-text">python序列化和反序列化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#marshal-%E8%AF%BB%E5%86%99pyc%E5%AD%97%E8%8A%82%E7%A0%81"><span class="nav-text">marshal(读写pyc字节码):</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/header-shrink.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/back2top.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/toggle-theme.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/code-block.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/main.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/local-search.min.js"></script>


<!-- lazyload -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/lazyload.min.js"></script>


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/post-helper.min.js"></script>

        <!-- toc -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/toc.min.js"></script>
        

        <!-- copyright-info -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/copyright-info.min.js"></script>
        

        <!-- share -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.3/js/post/share.min.js"></script>
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



    
        
    

</body>
</html>
